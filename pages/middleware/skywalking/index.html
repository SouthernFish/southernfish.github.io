<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>SkyWalking | Southern Fish</title><meta name="keywords" content="SkyWalking"><meta name="author" content="Southern Fish"><meta name="copyright" content="Southern Fish"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SkyWalking 属于中间件范畴，主要用于分布式系统中的链路追踪和性能监控。">
<meta property="og:type" content="article">
<meta property="og:title" content="SkyWalking">
<meta property="og:url" content="https://southernfish.github.io/pages/middleware/skywalking/index.html">
<meta property="og:site_name" content="Southern Fish">
<meta property="og:description" content="SkyWalking 属于中间件范畴，主要用于分布式系统中的链路追踪和性能监控。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://southernfish.github.io/img/article/article2.png">
<meta property="article:published_time" content="2025-07-09T11:35:36.000Z">
<meta property="article:modified_time" content="2025-09-19T03:12:49.333Z">
<meta property="article:author" content="Southern Fish">
<meta property="article:tag" content="SkyWalking">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://southernfish.github.io/img/article/article2.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://southernfish.github.io/pages/middleware/skywalking/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SkyWalking',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-19 11:12:49'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Southern Fish" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">96</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/article/article2.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Southern Fish</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SkyWalking</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-09T11:35:36.000Z" title="发表于 2025-07-09 19:35:36">2025-07-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-19T03:12:49.333Z" title="更新于 2025-09-19 11:12:49">2025-09-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Middleware/">Middleware</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Distributed-Architecture/">Distributed Architecture</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SkyWalking"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>SkyWalking 不是传统意义上的中间件，但属于分布式追踪系统，主要用于监控微服务架构中的服务调用链路和性能分析。它提供分布式追踪、服务网格遥测分析、度量聚合和可视化一体化解决方案，支持微服务、云原生架构，提供了总览、拓扑、应用、服务视图及链路追踪、告警等功能，能够串联用户请求到后端各系统节点的处理流程，帮助快速定位问题。</p>
<blockquote>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1953242">分布式链路追踪原理详解及SkyWalking、Zipkin介绍</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/AMimiDou_212/article/details/104749448">分布式全链路追踪 SkyWalking基本原理</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/1611839">链路跟踪-SkyWalking系列</a></p>
</blockquote>
<h1 id="SkyWalking"><a href="#SkyWalking" class="headerlink" title="SkyWalking"></a>SkyWalking</h1><h2 id="应用监控和链路跟踪"><a href="#应用监控和链路跟踪" class="headerlink" title="应用监控和链路跟踪"></a>应用监控和链路跟踪</h2><p>随着微服务架构的流行，开发的运维压力增大，经常需要面临这些问题： </p>
<ol>
<li><strong>链路较长</strong>：在微服务场景下，整个链路会变得很长，服务出问题时，往往不能第一时间排查出问题。 </li>
<li><strong>缺少监控</strong>：缺少对于服务器，应用组件的实时运行信息，做到心中有数。</li>
<li><strong>预警不及时，粒度较大</strong>：经常在服务器响应延迟甚至宕机后，才能发现问题，同时粒度较大，无法在接口层面进行预警。 </li>
</ol>
<p>基于Agent技术，SkyWalking提供了例如吞吐量，QPS，JVM信息等丰富的指标供参考，做到有效同时地告警，利用其丰富的插件，能帮助我们跟踪Dubbo，ElasticSearch，Redis等这些组件的调用链路。 通过SkyWalking做链路跟踪，系统监控，异常告警的落地，解决了开发过程中问题定位慢的痛点。</p>
<p>整个分布式追踪的目的是为了最终在<strong>页面上、UI上、和数据上能够复现分布式系统中服务调用的整个过程</strong>。在做分布式追踪时需要拿到完整的信息，包括<strong>精确的响应时间，访问的方法、访问的 circle，访问的 Redis 的 key</strong>等，最终展现出一个完整的链路。</p>
<p>一个请求完整的调用链路： 那么在业务规模不断增大，服务不断增多以及频繁变更的情况下，面对复杂的调用链路就带来一系列问题： </p>
<ol>
<li>如何快速发现问题？</li>
<li>如何判断故障影响范围？ </li>
<li>如何梳理服务依赖以及依赖的合理性？ </li>
<li>如何分析链路性能以及实时容量规划？ </li>
<li>吞吐量，根据拓扑可计算相应组件，平台，物理设备的实时吞吐量 </li>
<li>响应时间，包括整体调用的响应时间和各个服务的响应时间等。 </li>
<li>错误记录，根据服务返回统计单位时间异常次数。</li>
</ol>
<p>全链路性能监控从整体维度到局部维度展示各个指标，将跨应用的所有调用链路性能信息集中展现，可方便度量整体和局部性能，并且方便找到故障产生的源头，生产上可极大缩短故障排查时间。 有了全链路监控工具，能够达到：</p>
<ol>
<li><strong>请求链路跟踪，故障快速定位</strong>：可以通过调用链路结合业务日志快速定位错误信息。</li>
<li><strong>可视化</strong>：各个阶段耗时，进行性能分析</li>
<li><strong>依赖优化</strong>：各个调用环节的可用性，梳理服务依赖关系以及优化</li>
<li><strong>数据分析，优化链路</strong>：可以得到用户的行为路径，汇总分析应用在很多业务场景。</li>
</ol>
<h2 id="APM"><a href="#APM" class="headerlink" title="APM"></a>APM</h2><p>APM（Application Performance Management）应用性能管理，通过各种探针采集并上报数据，收集关键指标，同时搭配数据展示以实现对应用程序性能管理和故障管理的系统化解决方案。 </p>
<p>目前主要的一些 APM 工具有：Cat、Zipkin、Pinpoint、SkyWalking，这里主要介绍 SkyWalking ，它是一款优秀的国产 APM 工具，包括了分布式追踪、性能指标分析、应用和服务依赖分析等。 </p>
<p>Zabbix、Premetheus、open-falcon等监控系统主要关注服务器硬件指标与系统服务运行状态等，而APM系统则更重视程序内部执行过程指标和服务之间链路调用情况的监控，APM更有利于深入代码找到请求响应“慢”的根本问题，与 Zabbix 之类的监控是互补关系。</p>
<h2 id="Apache-SkyWalking-Incubator"><a href="#Apache-SkyWalking-Incubator" class="headerlink" title="Apache SkyWalking(Incubator)"></a>Apache SkyWalking(Incubator)</h2><p>Apache SkyWalking：</p>
<ul>
<li><p>分布式系统的应用程序性能监视工具，专为微服务、云原生架构和基于容器（Docker、K8s、Mesos）架构而设计。</p>
</li>
<li><p>Apache Skywalking(Incubator) 专门为微服务架构和云原生架构系统而设计并且支持分布式链路追踪的APM系统。Apache Skywalking(Incubator)通过加载 <strong>探针-非侵入式</strong> 的方式收集应用调用链路信息，并对采集的调用链路信息进行分析，生成应用间关系和服务间关系以及服务指标。</p>
</li>
<li><p>Apache Skywalking (Incubating)目前支持多种语言，其中包括Java，.Net Core，Node.js和Go语言。</p>
</li>
</ul>
<p>Skywalking已经支持从<strong>6个可视化维度</strong>剖析分布式系统的运行情况。</p>
<ul>
<li><strong>总览视图</strong>(<code>Global view</code>)是应用和组件的全局视图，其中包括组件和应用数量，应用的告警波动，慢服务列表以及应用吞吐量；</li>
<li><strong>拓扑图</strong>(<code>topology view</code>)从应用依赖关系出发，展现整个应用的拓扑关系；</li>
<li><strong>应用视图</strong>则是从单个应用的角度，展现应用的上下游关系，TopN的服务和服务器，JVM的相关信息以及对应的主机信息。</li>
<li><strong>服务视图</strong>关注单个服务入口的运行情况以及此服务的上下游依赖关系，依赖度，帮助用户针对单个服务的优化和监控；</li>
<li><strong>调用链</strong>(<code>trace</code>)展现了调用的单次请求经过的所有埋点以及每个埋点的执行时长；</li>
<li><strong>告警视图</strong>(<code>alarm</code>)根据配置阈值针对应用、服务器、服务进行实时告警。</li>
</ul>
<h2 id="什么是-SkyWalking"><a href="#什么是-SkyWalking" class="headerlink" title="什么是 SkyWalking"></a>什么是 SkyWalking</h2><ul>
<li>是观察性分析平台和应用性能管理系统。</li>
<li>提供分布式追踪、服务网格遥测分析、度量聚合和可视化一体化解决方案</li>
<li>支持Java， .Net Core，PHP，NodeJS，Golang，LUA语言探针</li>
<li>支持<code>Envoy + Istio</code>构建的 Service Mesh</li>
</ul>
<h2 id="javaAgent探针技术使用场景"><a href="#javaAgent探针技术使用场景" class="headerlink" title="javaAgent探针技术使用场景"></a>javaAgent探针技术使用场景</h2><ol>
<li>无入侵  <strong>链路跟踪</strong> </li>
<li>无入侵 <strong>动态线程池</strong> </li>
<li>无入侵  <code>TransmitThreadLocal </code></li>
<li>无入侵的  <strong>命令行交互模式JVM诊断Arthas</strong></li>
</ol>
<h2 id="SkyWalking-原理架构图"><a href="#SkyWalking-原理架构图" class="headerlink" title="SkyWalking 原理架构图"></a>SkyWalking 原理架构图</h2><p><img src="https://raw.githubusercontent.com/SouthernFish/ImageHostServer/main/system/image-20250711122919890.png" alt="image-20250711122919890"></p>
<p> <strong>SkyWalking支持三种探针：</strong></p>
<ol>
<li><strong>Agent</strong>：基于ByteBuddy字节码增强技术实现，通过jvm的agent参数加载，并在程序启动时拦截指定的方法来 收集数据。 (最推荐) </li>
<li><strong>SDK</strong>：程序中显式调用SkyWalking提供的SDK来收集数据，对应用有侵入。 </li>
<li><strong>Service Mesh</strong>：通过Service mesh的网络代理来收集数据。</li>
</ol>
<p> <strong>后端（Backend）</strong> </p>
<p>接受探针发送过来的数据，进行度量分析，调用链分析和存储。后端主要分为两部分： </p>
<p><strong>OAP</strong>（<code>Observability Analysis Platform</code>）：进行度量分析和调用链分析的后端平台，并支持将数据存储到各种数据库中，如：ElasticSearch，MySQL，InfluxDB等。</p>
<p><strong>OAL</strong>（<code>Observability Analysis Language</code>）：用来进行度量分析的DSL，类似于SQL，用于查询度量分析结果和警报。</p>
<h2 id="SkyWalking-核心模块"><a href="#SkyWalking-核心模块" class="headerlink" title="SkyWalking 核心模块"></a>SkyWalking 核心模块</h2><p>SkyWalking采用组件式开发，易于扩展，主要组件作用如下： </p>
<ol>
<li><strong>Skywalking Agent：</strong>链路数据采集<strong>tracing（调用链数据）和metric（指标）信息</strong>并上报，上报通过HTTP或者 gRPC 方式发送数据到Skywalking Collector </li>
<li><strong>Skywalking Collector ：</strong> 链路数据收集器，对agent传过来的<code>tracing</code>和<code>metric</code>数据进行整合分析通过<code>Analysis Core</code>模块处理并落入相关的数据存储中，同时会通过<code>Query Core</code>模块进行二次统计和监控告警 </li>
<li><strong>Storage：</strong> Skywalking的存储，支持以<code>ElasticSearch、Mysql、TiDB、H2</code>等主流存储作为存储介质进行数据存储，H2仅作为临时演示单机用。 </li>
<li><strong>SkyWalking UI：</strong> Web可视化平台，用来展示落地的数据，目前官方采纳了<code>RocketBot</code>作为SkyWalking的主UI</li>
</ol>
<h2 id="SkyWalking-UI组件视图"><a href="#SkyWalking-UI组件视图" class="headerlink" title="SkyWalking UI组件视图"></a>SkyWalking UI组件视图</h2><ol>
<li><p><strong>仪表盘</strong>：查看全局服务基本性能指标 仪表盘主要包含Service Dashboard和Database Dashboard </p>
<ul>
<li><p><strong>Service Dashboard：</strong>有Global、Service、Endpoint、Instance面板，展示了<strong>全局以及服务、端点、实例</strong>的详细信息</p>
</li>
<li><p><strong>Database Dashboard：</strong>展示数据库的<strong>响应时间、响应时间分布、吞吐量、SLA、慢SQL</strong>等详细信息，便于直观展示数据库状态</p>
</li>
</ul>
</li>
<li><p><strong>拓扑图</strong>：展示分布式服务之间调用关系： </p>
<ul>
<li><p>SkyWalking 能根据获取的数据自动绘制服务之间的调用关系图，并识别常见的服务显示在图标上，如 tomcat、CAS 服务  </p>
</li>
<li><p>每条连线的颜色反应了服务之间的调用延迟情况，可以非常直观的看到服务与服务之间的调用状态，连线中间的点能点击，可显示两个服务之间链路的平均响应时间、吞吐率以及SLA等信息，还可以展示服务的性能数据。</p>
</li>
</ul>
</li>
<li><p><strong>链路追踪</strong>：可以根据需求，查看链路调用过程</p>
<ul>
<li>显示请求的响应内部执行情况，一个完整的请求都经过了哪些服务、执行了哪些代码方法、每个方法的执行时间、执行状态等详细信息，快速定位代码问题。</li>
</ul>
</li>
</ol>
<ol start="4">
<li><strong>告警提示</strong></li>
<li> <strong>指标数据对比</strong></li>
</ol>
<h2 id="SkyWalking的特点"><a href="#SkyWalking的特点" class="headerlink" title="SkyWalking的特点"></a>SkyWalking的特点</h2><ol>
<li><strong>性能好</strong>：针对单实例5000tps的应用，在全量采集的情况下，只增加10%的CPU开销 </li>
<li>支持多语言探针</li>
<li>无入侵，支持自动以及手动探针</li>
</ol>
<p><strong>自动探针</strong>：java支持的中间件，框架与类库列表<br><strong>手动探针</strong>：OpenTrackingApi，@Trace注解，traceId集成到日志中</p>
<h2 id="SkyWalking三大架构模式"><a href="#SkyWalking三大架构模式" class="headerlink" title="SkyWalking三大架构模式"></a><strong>SkyWalking三大架构模式</strong></h2><ol>
<li>AOP架构模式</li>
<li>插件式架构模式</li>
<li>微内核架构模式</li>
</ol>
<p>一个组件具有高扩展架构的话，需要具有微内核架构/插件式架构/无入侵架构，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">高扩展架构</span><br><span class="line">    微内核架构</span><br><span class="line">        SkyWalking</span><br><span class="line">    插件式架构</span><br><span class="line">        SkyWalking</span><br><span class="line">        shardingJdbc</span><br><span class="line">        Spring、SpringBoot</span><br><span class="line">    无入侵架构</span><br><span class="line">        SkyWalking</span><br><span class="line">        Arthas</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="SkyWalking-安装部署"><a href="#SkyWalking-安装部署" class="headerlink" title="SkyWalking 安装部署"></a>SkyWalking 安装部署</h1><p>存储到ES需要先安装 ElasticSearch</p>
<h2 id="SkyWalking-安装"><a href="#SkyWalking-安装" class="headerlink" title="SkyWalking 安装"></a>SkyWalking 安装</h2><ol>
<li><p>下载 <a target="_blank" rel="noopener" href="https://www.apache.org/dyn/closer.cgi/skywalking/6.6.0/apache-skywalking-apm-6.6.0.tar.gz">压缩包</a></p>
</li>
<li><p>解压安装包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@example apache-skywalking-apm-bin]<span class="comment"># tar -xvf apache-skywalking-apm-6.6.0.tar.gz -C /opt/</span></span><br><span class="line"><span class="comment"># ll 查看详细列表</span></span><br><span class="line">agent        <span class="comment"># 探针客户端，Java -jar启动时参数指向agent里面的skywalking探针jar包</span></span><br><span class="line">bin            <span class="comment"># 启动脚本</span></span><br><span class="line">config        <span class="comment"># skyWalking 配置目录</span></span><br><span class="line">logs        <span class="comment"># 日志目录</span></span><br><span class="line">webapp        <span class="comment"># skyWalking ul</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置UI端口</p>
<p><strong>config：</strong>配置文件，主要修改application.yml里的agent采集的信息要存存储到哪里，默认H2，现改为ES。修改namespace为ES集群名，clusterNodes为ES集群各节点URL即可，其他暂时默认即可。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage:</span></span><br><span class="line">    <span class="attr">selector:</span> <span class="string">$&#123;SW_STORAGE:elasticsearch7&#125;</span></span><br><span class="line">    <span class="attr">elasticsearch7:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">$&#123;NAMESPACE:&quot;elasticsearch&quot;&#125;</span></span><br><span class="line">        <span class="attr">clusterNodes:</span> <span class="string">$&#123;SSW_STORAGEE_ES_CLUSTER_NODES:localhost:9200&#125;</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">$&#123;SSW_STORAGE_ES_HTTP_PROTOCOL:&quot;http&quot;&#125;</span></span><br><span class="line">        <span class="attr">trustStorePath:</span> <span class="string">$&#123;SISW_STORAGE_ES_SSL_JKS_PATH:&quot;&quot;&#125;</span></span><br><span class="line">        <span class="attr">trustStorePass:</span> <span class="string">$&#123;SISW_STORAGE_ES_SSL_JKS_PASS:&quot;&quot;&#125;</span></span><br><span class="line">        <span class="comment"># Represent the number of days in the one minute/hour/day index.</span></span><br><span class="line">        <span class="attr">dayStep:</span> <span class="string">$&#123;SW_STORAGE_DAY_STEP:l&#125;</span></span><br><span class="line">        <span class="attr">user:</span> <span class="string">$&#123;SW_ES_USER:&quot;&quot;&#125;</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">$&#123;SW_ES_PASSWORD:&quot;&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#    segmentQueryMaxSize: $&#123;SW_STORAGE_ES_QUERY_SEGMENT_SIZE:200&#125;</span></span><br><span class="line">    <span class="attr">h2:</span></span><br><span class="line">        <span class="attr">driver:</span> <span class="string">$&#123;SW_STORAGE_H2_DRIVER:org.h2.jdbcx.JdbcDataSource&#125;</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">$&#123;SW_STORAGE_H2_URL:jdbc:h2:mem:skywalking-oap-db&#125;</span></span><br><span class="line">        <span class="attr">user:</span> <span class="string">$&#123;SW_STORAGE_H2_USER:sa&#125;</span></span><br><span class="line">        <span class="attr">metadataQueryMaxSize:</span> <span class="string">$&#123;SW_STORAGE_H2_QUERY_MAX_SIZE:5000&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>webapp：</strong>将ES里的数据展示出来的UI项目基本配置，修改一下webapp.yml的server.port端口，默认8080</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span> <span class="comment"># 最好是改掉，因默认8080端口经常被占用，比如 8888</span></span><br><span class="line"><span class="attr">collector:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/graphql</span></span><br><span class="line">    <span class="attr">ribbon:</span></span><br><span class="line">        <span class="attr">ReadTimeout:</span> <span class="number">10000</span></span><br><span class="line">        <span class="comment"># Point to all backend&#x27;s restHost:restPort, split by</span></span><br><span class="line">        <span class="attr">listofservers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:12800</span></span><br></pre></td></tr></table></figure>

<p>bin启动脚本，startup.sh同时启动 oap（主要是将探针采集的数据上传到ES）和webapp（相当于zipkin-ui）两个服务，也可单独启动。<strong>注意：</strong>.bat 为windows 启动脚本；.sh为Linux 启动脚本；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@example apache-skywalking-apm-bin]<span class="comment"># ll bin</span></span><br><span class="line">total 40</span><br><span class="line">-rwxr-xr-x. 1 nginx 1002 1352 Dec 24 01:10 oapService.bat</span><br><span class="line">-rwxr-xr-x. 1 nginx 1002 1364 Dec 24 01:10 oapServiceInit.bat</span><br><span class="line">-rwxr-xr-x. 1 nginx 1002 1597 Dec 24 01:10 oapServiceInit.sh</span><br><span class="line">-rwxr-xr-x. 1 nginx 1002 1367 Dec 24 01:10 oapServiceNoInit.bat</span><br><span class="line">-rwxr-xr-x. 1 nginx 1002 1616 Dec 24 01:10 oapServiceNoInit.sh</span><br><span class="line">-rwxr-xr-x. 1 nginx 1002 1599 Dec 24 01:10 oapService.sh          <span class="comment"># oapService 服务启动脚本</span></span><br><span class="line">-rwxr-xr-x. 1 nginx 1002  941 Dec 24 01:10 startup.bat</span><br><span class="line">-rwxr-xr-x. 1 nginx 1002  934 Dec 24 01:10 startup.sh              <span class="comment"># 启动oap 和UI 服务</span></span><br><span class="line">-rwxr-xr-x. 1 nginx 1002 1426 Dec 24 01:10 webappService.bat</span><br><span class="line">-rwxr-xr-x. 1 nginx 1002 1630 Dec 24 01:10 webappService.sh      <span class="comment"># Web UI 启动脚本</span></span><br></pre></td></tr></table></figure></li>
<li><p>默认使用H2存储，启动SkyWalking的UI控制台，出现如下则证明启动成功，即可通过<a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a> 访问Web UI。如果启动失败，查询apache-skywalking-apm-bin/logs目录下日志skywalking-oap-server.log和SkyWalking UI日志webapp.log，跟进错误提示进行分析。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@example apache-skywalking-apm-bin]<span class="comment"># bin/startup.sh</span></span><br><span class="line">SkyWalking OAP started successfully!</span><br><span class="line">SkyWalking Web Application started successfully!</span><br></pre></td></tr></table></figure></li>
<li><p>配置后端存储</p>
</li>
</ol>
<h2 id="JavaAgent-部署"><a href="#JavaAgent-部署" class="headerlink" title="JavaAgent 部署"></a>JavaAgent 部署</h2><p>通过操作 Instrumentation 的 API 就可以实现不重启服务对单个类进行简单的修改。 通常有两种方式拿到 Instrumentation 对象：</p>
<ol>
<li>在 JVM 启动时指定 agent，Instrumentation 对象会通过 agent 的 premain 方法传递。</li>
<li>在 JVM 启动后通过 JVM 提供的机制加载 agent，Instrumentation 对象会通过 agent 的 agentmain 方法传递。</li>
</ol>
<p>Skywalking 就是通过在 JVM 启动时指定 agent，这样其实对于业务来说会减少一些不确定性，如果在运行期间侵入，至少在启动的过程中能预判一些不确定性，具体详情代码请参考：org.apache.skywalking.apm.agent.SkyWalkingAgent。 </p>
<p>业务应用在 Skywalking 中如何被零侵入，配置属性文件 env.properties，内容如下，注意将 skywalking-agent.jar 放到指定的路径上。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">JAVA_HOME</span>=<span class="string">&quot;/data/java/jdk1.8.0_161&quot;</span></span><br><span class="line"><span class="attr">JAVA_PARAMS</span>=<span class="string">&quot;$JAVA_PARAMS -DSW_AGENT_NAME=application-name&quot;</span></span><br><span class="line"><span class="attr">JAVA_PARAMS</span>=<span class="string">&quot;$JAVA_PARAMS -javaagent:/data/skywalking/skywalking-agent.jar&quot;</span></span><br></pre></td></tr></table></figure>

<p>部署 JavaAgent 探针流程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.Agent 用于JDK1.6-12</span></span><br><span class="line"><span class="comment"># 2.在SkyWalking 目录下找到agent目录</span></span><br><span class="line"><span class="comment"># 3.在config/agent.config修改agent.service_name名称，显示在UI控制台的名称， service_name填写微服务名称即可</span></span><br><span class="line"><span class="comment"># 4.设置后端Service 采集器 collector.backend_service，127.0.0.1:8080仅用于本地后端收集器。</span></span><br><span class="line">    <span class="comment"># 实际需要设置为SkyWalking服务器的地址和端口</span></span><br><span class="line"><span class="comment"># 5.添加 -javaagent:/path/to/skywalking-package/agent/skywalking-agent.jar到JVM参数之前，确保在 -jar之前。</span></span><br><span class="line"><span class="comment"># 6.启动应用</span></span><br></pre></td></tr></table></figure>

<p>Agent包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+-- agent</span><br><span class="line">    +-- activations</span><br><span class="line">         apm-toolkit-log4j-1.x-activation.jar</span><br><span class="line">         ...</span><br><span class="line">    +-- config</span><br><span class="line">         agent.config  </span><br><span class="line">    +-- plugins</span><br><span class="line">         apm-dubbo-plugin.jar</span><br><span class="line">         .....</span><br><span class="line">    +-- optional-plugins</span><br><span class="line">         apm-gson-2.x-plugin.jar</span><br><span class="line">         .....</span><br><span class="line">    +-- bootstrap-plugins</span><br><span class="line">         jdk-http-plugin.jar</span><br><span class="line">         .....</span><br><span class="line">    +-- logs</span><br><span class="line">    skywalking-agent.jar</span><br></pre></td></tr></table></figure>

<p>高级功能： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.默认日志输出到 logs 目录下。</span></span><br><span class="line"><span class="comment"># 2.所有支持的插件都存在 agent/plugins 目录下，在这个目录下移除插件jar包，这个插件将被禁用。（支持可插拔）</span></span><br></pre></td></tr></table></figure>

<h2 id="在Tomcat-上部署-JavaAgent"><a href="#在Tomcat-上部署-JavaAgent" class="headerlink" title="在Tomcat 上部署 JavaAgent"></a>在Tomcat 上部署 JavaAgent</h2><p>上传Agent目录到指定的Tomcat 器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]<span class="comment"># ll</span></span><br><span class="line">total 20248</span><br><span class="line">drwxrwxr-x.  8 mysql 1002      143 Mar  8 22:01 agent</span><br></pre></td></tr></table></figure>

<p>配置Agent配置文件，conf/agent.conf 设置<code>agent.service_name</code>、<code>collector.backend_service</code>;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]<span class="comment"># vim /opt/agent/config/agent.config</span></span><br><span class="line"><span class="comment"># The service name in UI</span></span><br><span class="line">agent.service_name=<span class="variable">$&#123;SW_AGENT_NAME:Tomcat-9&#125;</span></span><br><span class="line"><span class="comment"># Backend service addresses.  # 你的远程SkyWalking 服务器</span></span><br><span class="line">collector.backend_service=<span class="variable">$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES:127.0.0.1:11800&#125;</span></span><br></pre></td></tr></table></figure>

<p>启动Tomcat服务。</p>
<p>在远程SkyWalking 服务器通过端口查看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@example ~]<span class="comment"># netstat -natpl| grep java</span></span><br><span class="line">tcp6       0      0 192.168.2.106:11800     192.168.2.115:42108     ESTABLISHED 4091/java</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注： 正常启动java应用，带上如下参数：</span></span><br><span class="line">java -javaagent:/path/to/agent/skywalking-agent.jar <span class="variable">$yourApp</span>.jar</span><br></pre></td></tr></table></figure>

<h2 id="启动顺序"><a href="#启动顺序" class="headerlink" title="启动顺序"></a>启动顺序</h2><ol>
<li>先启动 <code>ElasticSearch</code></li>
<li>再启动 <code>SkyWalking</code></li>
<li>最后启动加入探针的微服务程序</li>
</ol>
<hr>
<h1 id="其他配置案例"><a href="#其他配置案例" class="headerlink" title="其他配置案例"></a>其他配置案例</h1><h2 id="SpringCloud集成SkyWalking"><a href="#SpringCloud集成SkyWalking" class="headerlink" title="SpringCloud集成SkyWalking"></a>SpringCloud集成SkyWalking</h2><p>参考文章<a target="_blank" rel="noopener" href="https://blog.csdn.net/WALK_MAN_wubiao/article/details/105426926">SpringCloud集成Skywalking</a></p>
<ol>
<li><p>下载解压apache-skywalking-apm-bin，比如安装解压在 D:/IDEA/skywalking/apache-skywalking-apm-bin</p>
</li>
<li><p>更新SpringBoot启动参数，可以在IDEA里面直接添加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-javaagent:D:/IDEA/skywalking/apache-skywalking-apm-bin/agent/skywalking-agent.jar </span><br><span class="line">-Dskywalking.agent.service_name=test-demo-eureka             <span class="comment"># 名称自定义，一般和application.name一致</span></span><br><span class="line">-Dskywalking.collector.backend_service=localhost:11800         <span class="comment"># 端口IP指向部署skywalking，skywalking-oap</span></span><br></pre></td></tr></table></figure></li>
<li><p>重新启动应用，再Skywalking管理台查看服务和应用探针是否正常</p>
</li>
</ol>
<h2 id="在Java服务中配置-Agent"><a href="#在Java服务中配置-Agent" class="headerlink" title="在Java服务中配置 Agent"></a>在Java服务中配置 Agent</h2><p>参考文章<a target="_blank" rel="noopener" href="https://blog.csdn.net/xjk201/article/details/104988958">skywalking的接入微服务</a>、推荐文章<a target="_blank" rel="noopener" href="https://www.alibabacloud.com/help/zh/opentelemetry/user-guide/use-skywalking-to-report-java-application-data#1aa421c948t3t">通过SkyWalking上报Java应用数据</a></p>
<p><strong>1.配置</strong></p>
<p>将apache-skywalking-apm-bin/agent下文件copy到Java服务器上，放到指定目录下，配置agent/config/agent.config，设置skywalking服务地址，见下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The service name in UI</span></span><br><span class="line">agent.service_name=<span class="variable">$&#123;SW_AGENT_NAME:Your_ApplicationName&#125;</span></span><br><span class="line"><span class="comment"># Backend service addresses.  # 你的远程SkyWalking 服务器</span></span><br><span class="line">collector.backend_service=<span class="variable">$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES:127.0.0.1:11800&#125;</span></span><br></pre></td></tr></table></figure>

<p>在agent.service_name配置你的服务名称，用于在skywalking UI显示，配置collector.backend_service选项，配置skywalking服务地址和端口，用于agient上报数据。 </p>
<p><strong>2.启动</strong></p>
<p>在java启动命令里加上 -javaagent:[jar包目录]/agent/skywalking-agent.jar<br>启动完成后，可以观察 Web UI看数据是否上报OK</p>
<h2 id="Docker部署Agent"><a href="#Docker部署Agent" class="headerlink" title="Docker部署Agent"></a>Docker部署Agent</h2><p>转载自<a target="_blank" rel="noopener" href="https://blog.csdn.net/WALK_MAN_wubiao/article/details/105426867">Docker安装Skywalking</a></p>
<ol>
<li><p>下载镜像：我本地下载的镜像打了tag </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/anoy/skywalking-ui </span><br><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/anoy/skywalking-oap</span><br></pre></td></tr></table></figure></li>
<li><p>运行镜像：账户密码（admin/admin，密码自己定义） </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name skywalking-oap -p 11800:11800 -e TZ=Asia/Shanghai skywalking-oap </span><br><span class="line">docker run -d --name skywalking-ui --<span class="built_in">link</span> skywalking-oap:skywalking-oap -p 8088:8080 -e TZ=Asia/Shanghai skywalking-ui --collector.ribbon.listOfServers=skywalking-oap:12800 --security.user.admin.password=admin</span><br></pre></td></tr></table></figure></li>
<li><p>查看应用是否正常启动</p>
</li>
</ol>
<h2 id="SkyWalking-透传-kafka的-Agent"><a href="#SkyWalking-透传-kafka的-Agent" class="headerlink" title="SkyWalking 透传 kafka的 Agent"></a>SkyWalking 透传 kafka的 Agent</h2><ol>
<li><p><strong>‌安装Kafka和Zookeeper‌</strong>  </p>
<p>Kafka和Zookeeper是SkyWalking使用Kafka进行数据传输所必需的。 </p>
</li>
<li><p><strong>移动Kafka插件‌</strong></p>
<p>将Kafka插件移动到plugins目录‌：将SkyWalking agent的optional-reporter-plugins目录下的kafka-reporter-plugin-x.x.x.jar（x.x.x代表版本号）移动到plugins目录下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> optional-reporter-plugins/kafka-reporter-plugin-x.x.x.jar plugins/</span><br></pre></td></tr></table></figure></li>
<li><p><strong>编辑agent.conf‌</strong></p>
<p>在SkyWalking agent的config目录下，找到agent.conf配置文件。需要添加或修改以下配置项以启用Kafka上报:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># agent.conf 文件中的部分配置</span></span><br><span class="line"><span class="attr">plugin.kafka.bootstrap_servers</span>=<span class="string">localhost:9092</span></span><br><span class="line"><span class="attr">plugin.kafka.namespace</span>=<span class="string">skywalking-logs</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 另外配置了地址的，用引用方式</span></span><br><span class="line"><span class="comment"># 配置Kafka服务地址</span></span><br><span class="line"><span class="attr">plugin.kafka.bootstrap_servers</span>=<span class="string">$&#123;SW_KAFKA_BOOTSTRAP_SERVERS:localhost:9092&#125;</span></span><br><span class="line"><span class="comment"># 配置Kafka的Topic</span></span><br><span class="line"><span class="attr">plugin.kafka.namespace</span>=<span class="string">$&#123;SW_KAFKA_NAMESPACE:skywalking-logs&#125;</span></span><br></pre></td></tr></table></figure>

<p>注意：确保Kafka服务正在运行，并且你使用的端口与bootstrap_servers配置中的端口相匹配。</p>
</li>
<li><p><strong>启动应用</strong>‌：<br>使用带有SkyWalking agent的JVM参数启动你的应用。SkyWalking agent将开始收集数据，并通过Kafka发送到OAP服务器。  </p>
</li>
<li><p> <strong>验证Kafka透传是否成功</strong></p>
</li>
</ol>
<p>   要验证Kafka透传是否成功，你可以使用Kafka命令行工具来检查数据是否已被成功发送到指定的Topic中。你可以使用如下命令：</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic skywalking-logs --from-beginning</span><br></pre></td></tr></table></figure>

<p>   如果一切配置正确，你将能看到SkyWalking agent发送的跟踪数据在控制台上滚动显示。</p>
<h2 id="skywalking监控中间件redis"><a href="#skywalking监控中间件redis" class="headerlink" title="skywalking监控中间件redis"></a>skywalking监控中间件redis</h2><p>参考文章<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_16213425/8958628">skywalking监控中间件redis</a></p>
<ol>
<li><p>配置SkyWalking Agent：步骤同上 Java Agent 部署</p>
</li>
<li><p>配置Redis</p>
<p>在监控Redis之前，需要为Redis启用Trace功能，并配置Trace的采样率。 对于使用Spring Boot的应用程序，你可以在<code>application.properties</code>文件中添加以下配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务名称</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">your-application-name</span></span><br><span class="line"><span class="comment"># SkyWalking配置</span></span><br><span class="line"><span class="attr">skywalking.trace.redis.host</span>=<span class="string">your-redis-host</span></span><br><span class="line"><span class="attr">skywalking.trace.redis.port</span>=<span class="string">your-redis-port</span></span><br><span class="line"><span class="attr">skywalking.trace.redis.sample-rate</span>=<span class="string">0.5</span></span><br></pre></td></tr></table></figure></li>
<li><p>启动SkyWalking Agent</p>
<p>在Agent安装目录下，找到skywalking-agent.jar的文件。通过以下命令启动Agent：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar skywalking-agent.jar</span><br></pre></td></tr></table></figure></li>
<li><p>查看监控数据</p>
<p>一旦SkyWalking Agent启动成功，它将会开始收集和发送监控数据到SkyWalking服务器。 你可以通过访问SkyWalking的Web界面来查看监控数据。在浏览器中输入<a href="http://localhost:8080，即可访问SkyWalking的控制台。">http://localhost:8080，即可访问SkyWalking的控制台。</a> 在控制台中选择查看Redis相关的监控数据，如请求数、响应时间等。</p>
</li>
</ol>
<hr>
<h1 id="SkyWalking探针采集数据如何收集"><a href="#SkyWalking探针采集数据如何收集" class="headerlink" title="SkyWalking探针采集数据如何收集"></a>SkyWalking探针采集数据如何收集</h1><p>参考文章<a target="_blank" rel="noopener" href="https://blog.csdn.net/huxian1234/article/details/135568041">布式链路追踪：Skywalking 探针模型设计</a></p>
<p>既然是分布式链路平台，那么数据收集肯定的核心功能，在 Skywalking 中，数据是通过探针侵入业务，然后通过通信通道传输到 OAP Server 端。针对每一个探针，其实收集的逻辑都不太一样，这里我就重点分析下常用技术中间件的探针数据是如何收集的。</p>
<h2 id="gateway-2-1-x-plugin"><a href="#gateway-2-1-x-plugin" class="headerlink" title="gateway-2.1.x-plugin"></a>gateway-2.1.x-plugin</h2><p>Spring Cloud Gateway 是一个非常火的服务治理网关，所以 Skywalking 肯定是要支持对它的性能数据的采集。</p>
<ol>
<li><strong>定义探针</strong> <code>FilteringWebHandlerInstrumentation</code>，用于增强 org.springframework.cloud.gateway.handler.FilteringWebHandler，拦截 FilteringWebHandler 中以 handle 开头的方法。</li>
<li><strong>定义拦截器</strong> <code>FilteringWebHandlerInterceptor</code>，在 beforeMethod 方法中植入需要采集的数据，从 allArguments 参数中，获取到当前网关路由的 ServerWebExchange，然后拼装 operationName，例如： operationName + route.getId()。</li>
<li>**<code>HttpClientOperationsSendInterceptor</code>**，创建 AbstractSpan 并设置组件类型为 ComponentsDefine.SPRING_CLOUD_GATEWAY，最后调用 ContextManager.stopSpan(span) 存储链路数据。</li>
</ol>
<h2 id="dubbo-2-7-x-plugin"><a href="#dubbo-2-7-x-plugin" class="headerlink" title="dubbo-2.7.x-plugin"></a>dubbo-2.7.x-plugin</h2><p>Dubbo 框架肯定是得支持的，如何支持？</p>
<ol>
<li><strong>定义探针</strong> <code>DubboInstrumentation</code>，并增强类 org.apache.dubbo.monitor.support.MonitorFilter，这个类是 Dubbo 服务治理的核心类，拦截的方法必须是要含有 invoke 字段。</li>
<li><strong>拦截器</strong> <code>DubboInterceptor</code>，通过 beforeMethod，获取到 Invoker、Invocation 和 RpcContext，然后再区分是消费者还是提供者，如果是消费者，那么就是 ExitSpan，如果是提供者就是 EntrySpan，从链路数据流向来看，消费者是出去，而提供者流量是流入。createExitSpan 和 createEntrySpan，就会植入一些性能采集指标，比如 RT 等。</li>
</ol>
<h2 id="jedis-2-x-plugin"><a href="#jedis-2-x-plugin" class="headerlink" title="jedis-2.x-plugin"></a>jedis-2.x-plugin</h2><ol>
<li><strong>定义探针</strong>:<code>JedisInstrumentation</code>，这个探针用于植入类 redis.clients.jedis.Jedis。</li>
<li><strong>定义一批特殊处理的拦截器</strong>——最常规的拦截器就是 <code>JedisMethodInterceptor</code>，并通过 beforeMethod、afterMethod 和 handleMethodException 采集链路信息。</li>
</ol>
<p>其他组件基本都是一样的，都是通过基于字节码的 AOP 技术来植入链路采集数据。</p>
<p>关于 Skywalking 探针的链路数据采集我们需要知道底层核心，我在这里就列举下：</p>
<ol>
<li><p><strong>StaticMethodsInter</strong></p>
<p>用于拦截类实例方法的实际字节 buddy 拦截器。这个类用于连接 Byte-buddy 和 Skywalking plugin。</p>
</li>
<li><p><strong>ConstructorInter</strong></p>
<p>用于拦截构造函数方法的实际字节 buddy 拦截器，然后通过自定义 intercept 方法逻辑，调用拦截器的 onConstruct 逻辑，完成基于构造函数的请求拦截。</p>
</li>
<li><p><strong>InstMethodsInter</strong></p>
<p>用于拦截实例方法的实际字节 buddy 拦截器，自定义 intercept 方法，然后再方法中国封装拦截器对 beforeMethod、handleMethodException 和 afterMethod 这三个方法的调用。</p>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://southernfish.github.io">Southern Fish</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://southernfish.github.io/pages/middleware/skywalking/">https://southernfish.github.io/pages/middleware/skywalking/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://southernfish.github.io" target="_blank">Southern Fish</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SkyWalking/">SkyWalking</a></div><div class="post_share"><div class="social-share" data-image="/img/article/article2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/pages/distributed/dubbo/"><img class="prev-cover" src="/img/article/article2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Dubbo</div></div></a></div><div class="next-post pull-right"><a href="/pages/distributed/rpc/"><img class="next-cover" src="/img/article/article2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">远程过程调用</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Southern Fish</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">96</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/SouthernFish" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1002721576@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">天下事岂能尽如吾意，心境须恰适，尽其在我，随遇而安。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SkyWalking"><span class="toc-number">1.</span> <span class="toc-text">SkyWalking</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%9B%91%E6%8E%A7%E5%92%8C%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA"><span class="toc-number">1.1.</span> <span class="toc-text">应用监控和链路跟踪</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#APM"><span class="toc-number">1.2.</span> <span class="toc-text">APM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-SkyWalking-Incubator"><span class="toc-number">1.3.</span> <span class="toc-text">Apache SkyWalking(Incubator)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-SkyWalking"><span class="toc-number">1.4.</span> <span class="toc-text">什么是 SkyWalking</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#javaAgent%E6%8E%A2%E9%92%88%E6%8A%80%E6%9C%AF%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.5.</span> <span class="toc-text">javaAgent探针技术使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SkyWalking-%E5%8E%9F%E7%90%86%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-number">1.6.</span> <span class="toc-text">SkyWalking 原理架构图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SkyWalking-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="toc-number">1.7.</span> <span class="toc-text">SkyWalking 核心模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SkyWalking-UI%E7%BB%84%E4%BB%B6%E8%A7%86%E5%9B%BE"><span class="toc-number">1.8.</span> <span class="toc-text">SkyWalking UI组件视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SkyWalking%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">1.9.</span> <span class="toc-text">SkyWalking的特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SkyWalking%E4%B8%89%E5%A4%A7%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.10.</span> <span class="toc-text">SkyWalking三大架构模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SkyWalking-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text">SkyWalking 安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SkyWalking-%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">SkyWalking 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaAgent-%E9%83%A8%E7%BD%B2"><span class="toc-number">2.2.</span> <span class="toc-text">JavaAgent 部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8Tomcat-%E4%B8%8A%E9%83%A8%E7%BD%B2-JavaAgent"><span class="toc-number">2.3.</span> <span class="toc-text">在Tomcat 上部署 JavaAgent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F"><span class="toc-number">2.4.</span> <span class="toc-text">启动顺序</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">其他配置案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringCloud%E9%9B%86%E6%88%90SkyWalking"><span class="toc-number">3.1.</span> <span class="toc-text">SpringCloud集成SkyWalking</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8Java%E6%9C%8D%E5%8A%A1%E4%B8%AD%E9%85%8D%E7%BD%AE-Agent"><span class="toc-number">3.2.</span> <span class="toc-text">在Java服务中配置 Agent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E9%83%A8%E7%BD%B2Agent"><span class="toc-number">3.3.</span> <span class="toc-text">Docker部署Agent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SkyWalking-%E9%80%8F%E4%BC%A0-kafka%E7%9A%84-Agent"><span class="toc-number">3.4.</span> <span class="toc-text">SkyWalking 透传 kafka的 Agent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#skywalking%E7%9B%91%E6%8E%A7%E4%B8%AD%E9%97%B4%E4%BB%B6redis"><span class="toc-number">3.5.</span> <span class="toc-text">skywalking监控中间件redis</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SkyWalking%E6%8E%A2%E9%92%88%E9%87%87%E9%9B%86%E6%95%B0%E6%8D%AE%E5%A6%82%E4%BD%95%E6%94%B6%E9%9B%86"><span class="toc-number">4.</span> <span class="toc-text">SkyWalking探针采集数据如何收集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#gateway-2-1-x-plugin"><span class="toc-number">4.1.</span> <span class="toc-text">gateway-2.1.x-plugin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dubbo-2-7-x-plugin"><span class="toc-number">4.2.</span> <span class="toc-text">dubbo-2.7.x-plugin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jedis-2-x-plugin"><span class="toc-number">4.3.</span> <span class="toc-text">jedis-2.x-plugin</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/pages/high-availability/server-limit-stream/" title="服务限流"><img src="/img/article/article2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="服务限流"/></a><div class="content"><a class="title" href="/pages/high-availability/server-limit-stream/" title="服务限流">服务限流</a><time datetime="2025-09-18T09:02:36.000Z" title="发表于 2025-09-18 17:02:36">2025-09-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/pages/database/db-redis-persistence/" title="Redis的持久化机制"><img src="/img/article/article6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis的持久化机制"/></a><div class="content"><a class="title" href="/pages/database/db-redis-persistence/" title="Redis的持久化机制">Redis的持久化机制</a><time datetime="2025-09-18T01:15:36.000Z" title="发表于 2025-09-18 09:15:36">2025-09-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/pages/database/cache-read-write-strategies/" title="三大缓存读写策略"><img src="/img/article/article1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="三大缓存读写策略"/></a><div class="content"><a class="title" href="/pages/database/cache-read-write-strategies/" title="三大缓存读写策略">三大缓存读写策略</a><time datetime="2025-09-17T13:15:36.000Z" title="发表于 2025-09-17 21:15:36">2025-09-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/pages/database/db-redis-cache-read-write/" title="三大缓存读写策略"><img src="/img/article/article3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="三大缓存读写策略"/></a><div class="content"><a class="title" href="/pages/database/db-redis-cache-read-write/" title="三大缓存读写策略">三大缓存读写策略</a><time datetime="2025-09-17T13:15:36.000Z" title="发表于 2025-09-17 21:15:36">2025-09-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/pages/database/db-redis-consistency/" title="Redis缓存与数据库的一致性"><img src="/img/article/article2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis缓存与数据库的一致性"/></a><div class="content"><a class="title" href="/pages/database/db-redis-consistency/" title="Redis缓存与数据库的一致性">Redis缓存与数据库的一致性</a><time datetime="2025-09-17T13:15:36.000Z" title="发表于 2025-09-17 21:15:36">2025-09-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/article/article2.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Southern Fish</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>