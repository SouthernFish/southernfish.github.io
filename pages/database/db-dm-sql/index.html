<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>达梦数据库SQL操作 | Southern Fish</title><meta name="keywords" content="DM"><meta name="author" content="Southern Fish"><meta name="copyright" content="Southern Fish"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="‌达梦数据库（DM Database）是一款由中国公司自主研发的关系型数据库管理系统。了解其基本概念有助于更好地使用和管理该数据库。">
<meta property="og:type" content="article">
<meta property="og:title" content="达梦数据库SQL操作">
<meta property="og:url" content="https://southernfish.github.io/pages/database/db-dm-sql/index.html">
<meta property="og:site_name" content="Southern Fish">
<meta property="og:description" content="‌达梦数据库（DM Database）是一款由中国公司自主研发的关系型数据库管理系统。了解其基本概念有助于更好地使用和管理该数据库。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://southernfish.github.io/img/article/article3.png">
<meta property="article:published_time" content="2025-09-17T13:15:36.000Z">
<meta property="article:modified_time" content="2025-09-26T06:31:52.063Z">
<meta property="article:author" content="Southern Fish">
<meta property="article:tag" content="DM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://southernfish.github.io/img/article/article3.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://southernfish.github.io/pages/database/db-dm-sql/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '达梦数据库SQL操作',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-26 14:31:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Southern Fish" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">98</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/article/article3.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Southern Fish</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">达梦数据库SQL操作</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-17T13:15:36.000Z" title="发表于 2025-09-17 21:15:36">2025-09-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-26T06:31:52.063Z" title="更新于 2025-09-26 14:31:52">2025-09-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Database/">Database</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>31分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="达梦数据库SQL操作"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>达梦数据库（DM Database）是一款由中国公司自主研发的关系型数据库管理系统。它在安全性、性能、易用性等方面具有许多独特的优势。本文简单记录其 sql 简单使用。更多 SQL 语言使用说明，请参考《DM_SQL 语言使用手册》，手册位于<strong>数据库安装路径</strong> <code>/dmdbms/doc</code> 文件夹下。如有其他问题，请在<a target="_blank" rel="noopener" href="https://eco.dameng.com/community/question?_blank">社区</a>内咨询。</p>
<blockquote>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://eco.dameng.com/document/dm/zh-cn/start/install-dm-windows-prepare.html">达梦技术文档</a></p>
</blockquote>
<h1 id="常规数据类型"><a href="#常规数据类型" class="headerlink" title="常规数据类型"></a>常规数据类型</h1><p>DM SQL 程序支持所有的 DM SQL 数据类型，包括：<strong>精确数值数据类型、近似数值数据类型、字符数据类型、多媒体数据类型、一般日期时间数据类型、时间间隔数据类型</strong>。此外，DM SQL 还扩展支持了 %TYPE、%ROWTYPE、记录类型、数组类型、集合类型和类类型，用户还可以定义自己的子类型。</p>
<p>DM 数据库具有 SQL-92 的绝大部分数据类型，常规数据类型主要包括如下几大类：</p>
<ul>
<li><strong>字符数据类型</strong></li>
<li><strong>数值数据类型</strong></li>
<li><strong>位串数据类型</strong>，即 bit 类型</li>
<li><strong>日期时间数据类型</strong>，包括一般日期时间数据类型、时区数据类型和时间间隔数据类型</li>
<li><strong>多媒体数据类型</strong>，主要包括两种格式，字符串和二进制</li>
</ul>
<h2 id="字符数据类型"><a href="#字符数据类型" class="headerlink" title="字符数据类型"></a>字符数据类型</h2><p>根据数据库初始化时的参数不同，字符串中能存储的汉字的个数也不尽相同。主要由如下参数决定：</p>
<ul>
<li><p><code>UNICODE_FLAG</code>：此参数表示了数据库中所有数据的字符集，包括数据字典的字符集。<strong>需要注意的是，字符集在安装初始化库的时候指定，数据库一旦初始化完成，字符集就将无法修改</strong>。我们可以使用 <code>select unicode</code> 来查询当前数据库的字符集种类，0 代表 gb18030；1 代表 UTF-8。</p>
</li>
<li><p>VARCHAR 类型</p>
<blockquote>
<p>若没有指定 <code>USING LONG ROW</code> 存储选项时，插入 VARCHAR 数据类型的实际最大存储长度由数据库页面大小决定；如果指定了 <code>USING LONG ROW</code> 存储选项，则插入 VARCHAR 数据类型的长度不受数据库页面大小限制。VARCHAR 类型在表达式计算中的长度上限不受页面大小限制，为 32767。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询数据库的页大小</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;页大小&#x27;</span>,<span class="built_in">cast</span>(PAGE()<span class="operator">/</span><span class="number">1024</span> <span class="keyword">as</span> <span class="type">varchar</span>)；</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表，定义字段为 VARCHAR 类型，定长为 3</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dmhr.CHAR_TEST(</span><br><span class="line">       name <span class="type">VARCHAR</span>(<span class="number">3</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 插入 1 个汉字成功</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dmhr.CHAR_TEST <span class="keyword">values</span>(<span class="string">&#x27;测&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="comment">-- 插入 2 个汉字失败</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dmhr.CHAR_TEST <span class="keyword">values</span>(<span class="string">&#x27;测试&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="comment">-- 回滚</span></span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure>

<h3 id="在字符串中增加引号"><a href="#在字符串中增加引号" class="headerlink" title="在字符串中增加引号"></a>在字符串中增加引号</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将一个单引号换成两个单引号，引入单引号</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;girl&#x27;&#x27;day&#x27;</span> qmarks <span class="keyword">FROM</span> DUAL <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="string">&#x27;&#x27;&#x27;&#x27;</span> <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="comment">-- 使用界定符，通过 Q 或者 q 开头，字符串前后使用界定符 “ ‘ ”</span></span><br><span class="line"><span class="keyword">SELECT</span> q<span class="string">&#x27;[girl&#x27;</span><span class="keyword">day</span>]<span class="string">&#x27; qmarks FROM DUAL UNION ALL SELECT q&#x27;</span>[<span class="string">&#x27;]&#x27;</span> <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>

<h3 id="计算字符出现的次数"><a href="#计算字符出现的次数" class="headerlink" title="计算字符出现的次数"></a>计算字符出现的次数</h3><p>使用函数 <code>regexp_count、regexp_replace 或 translate</code> 统计子串个数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建测试视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> v <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="string">&#x27;STUDENT,TEACHER,TEAM&#x27;</span> <span class="keyword">AS</span> str <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="comment">-- 使用函数 regexp_count 统计子串个数</span></span><br><span class="line"><span class="keyword">SELECT</span> regexp_count(str,<span class="string">&#x27;,&#x27;</span>)<span class="operator">+</span><span class="number">1</span> <span class="keyword">as</span> cnt <span class="keyword">FROM</span> v;</span><br><span class="line"><span class="comment">-- 使用 regexp_replace 迂回求值统计子串个数</span></span><br><span class="line"><span class="keyword">SELECT</span> length(regexp_replace(str,<span class="string">&#x27;[^,]&#x27;</span>))<span class="operator">+</span><span class="number">1</span> <span class="keyword">as</span> cnt <span class="keyword">FROM</span> v;</span><br><span class="line"><span class="comment">-- 使用 translate 统计子串个数</span></span><br><span class="line"><span class="keyword">SELECT</span> length(<span class="built_in">translate</span>(str,<span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> str,<span class="string">&#x27;,&#x27;</span>))<span class="operator">+</span><span class="number">1</span> <span class="keyword">AS</span> cnt <span class="keyword">FROM</span> v;</span><br></pre></td></tr></table></figure>

<h3 id="删除字符串中不需要的字符"><a href="#删除字符串中不需要的字符" class="headerlink" title="删除字符串中不需要的字符"></a>删除字符串中不需要的字符</h3><p>使用 <code>translate</code> 或者 <code>regexp_replace</code> 在某个字段中去掉不需要的字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 translate 方法</span></span><br><span class="line"><span class="keyword">SELECT</span> ename,<span class="built_in">translate</span>(ename,<span class="string">&#x27;1AEIOU&#x27;</span>,<span class="string">&#x27;1&#x27;</span>) stripped1 <span class="keyword">FROM</span> v;</span><br><span class="line"><span class="comment">-- 使用正则函数 regexp_replace [] 内列举的字符替换为空，示例语句如下所示：</span></span><br><span class="line"><span class="keyword">SELECT</span> ename,regexp_replace(ename,<span class="string">&#x27;[AEIOU]&#x27;</span>) <span class="keyword">AS</span> stripped <span class="keyword">FROM</span> v;</span><br></pre></td></tr></table></figure>

<h3 id="将字符与数字分离"><a href="#将字符与数字分离" class="headerlink" title="将字符与数字分离"></a>将字符与数字分离</h3><p>使用 <code>regexp_replace</code> 正则表达式实现字符串中字符与数字分离。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> REGEXP_REPLACE (data, <span class="string">&#x27;[0-9]&#x27;</span>, <span class="string">&#x27;&#x27;</span>) dname, REGEXP_REPLACE (data, <span class="string">&#x27;[^0-9]&#x27;</span>, <span class="string">&#x27;&#x27;</span>) deptno <span class="keyword">FROM</span> v;</span><br></pre></td></tr></table></figure>

<h3 id="查询只包含字母或数字的数据"><a href="#查询只包含字母或数字的数据" class="headerlink" title="查询只包含字母或数字的数据"></a>查询只包含字母或数字的数据</h3><p>有些数据包含了空格、逗号、$ 等字符。使用 <code>regexp_like</code> 实现查询只包含字母或者数字型的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> data <span class="keyword">FROM</span> v <span class="keyword">WHERE</span> REGEXP_LIKE (data, <span class="string">&#x27;^[0-9a-zA-Z]+$&#x27;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong></p>
<ol>
<li>regexp_like(data,’A’) 对应普通的like ‘%A%’。</li>
<li>前面加“^”，regexp_like(data,’^A’) 对应普通的like ‘A%’，没有前模糊查询。</li>
<li>后面加“$”，regexp_like(data,’A$’) 对应普通的like ‘%A’，没有后模糊查询。</li>
<li>前后各加“^$”，regexp_like(data,’^A$’) 对应普通的like ‘A’，变成精确查询。</li>
</ol>
</blockquote>
<h3 id="按字符串中的数字排序"><a href="#按字符串中的数字排序" class="headerlink" title="按字符串中的数字排序"></a>按字符串中的数字排序</h3><p>通过正则表达式或者 <code>translate</code> 函数实现按字符串中的数值排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 用正则表达式替换非数字字符</span></span><br><span class="line"><span class="keyword">SELECT</span> data, TO_NUMBER (REGEXP_REPLACE (data, <span class="string">&#x27;[^0-9]&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) <span class="keyword">AS</span> deptno <span class="keyword">FROM</span> V <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">-- 使用 translate 函数，直接替换掉非数字字符</span></span><br><span class="line"><span class="keyword">SELECT</span> data, TO_NUMBER (<span class="built_in">TRANSLATE</span> (data, <span class="string">&#x27;0123456789&#x27;</span> <span class="operator">||</span> data, <span class="string">&#x27;0123456789&#x27;</span>)) <span class="keyword">AS</span> deptno <span class="keyword">FROM</span> V <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="创建分隔列表"><a href="#创建分隔列表" class="headerlink" title="创建分隔列表"></a>创建分隔列表</h3><p>使用 listagg 分析函数实现合并显示，同 sum 一样，listagg 函数也起到汇总结果作用。sum 将数值结果累计求和，而 listagg 是把字符串的结果连在一起。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    deptno,<span class="built_in">SUM</span> (sal) <span class="keyword">AS</span> total_sal, </span><br><span class="line">    <span class="built_in">LISTAGG</span> (name, <span class="string">&#x27;,&#x27;</span>) <span class="keyword">WITHIN</span> <span class="keyword">GROUP</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> name) <span class="keyword">AS</span> total_name</span><br><span class="line"><span class="keyword">FROM</span> v</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno;</span><br></pre></td></tr></table></figure>

<h3 id="提取子串与分解-IP-地址"><a href="#提取子串与分解-IP-地址" class="headerlink" title="提取子串与分解 IP 地址"></a>提取子串与分解 IP 地址</h3><p>通过 <code>regexp_substr</code> 实现第 n 个子串的分割，字符串拆分。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 比如在&quot;CLARK,KATE,JAMES&quot;字符串中提取出“KATE”</span></span><br><span class="line"><span class="keyword">SELECT</span> REGEXP_SUBSTR (v.name,<span class="string">&#x27;[^,]+&#x27;</span>,<span class="number">1</span>,<span class="number">2</span>) <span class="keyword">AS</span> 子串 <span class="keyword">FROM</span> v;</span><br><span class="line"><span class="comment">-- 将 IP 地址“192.168.1.111”中的各段取出来</span></span><br><span class="line"><span class="keyword">SELECT</span> REGEXP_SUBSTR (v.ip,<span class="string">&#x27;[^.]+&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>) a,</span><br><span class="line">       REGEXP_SUBSTR (v.ip,<span class="string">&#x27;[^.]+&#x27;</span>,<span class="number">1</span>,<span class="number">2</span>) b,</span><br><span class="line">       REGEXP_SUBSTR (v.ip,<span class="string">&#x27;[^.]+&#x27;</span>,<span class="number">1</span>,<span class="number">3</span>) c,</span><br><span class="line">       REGEXP_SUBSTR (v.ip,<span class="string">&#x27;[^.]+&#x27;</span>,<span class="number">1</span>,<span class="number">4</span>) d</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="string">&#x27;192.168.1.111&#x27;</span> <span class="keyword">AS</span> ip <span class="keyword">FROM</span> DUAL) v;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参数 1：“^”在方括号里表示否的意思，+ 表示匹配 1 次以上。第二个参数表示匹配不包含逗号的多个字符。</p>
<p>参数 2：“1”表示从第一个字符开始。</p>
<p>参数 3：“2”表示第二个能匹配目标的字符串，也就是 KATE。</p>
</blockquote>
<h2 id="数值数据类型"><a href="#数值数据类型" class="headerlink" title="数值数据类型"></a>数值数据类型</h2><ul>
<li><strong>精确数值数据类型包括</strong>：NUMERIC、DECIMAL、DEC 类型、NUMBER 类型、INTEGER 类型、INT 类型、BIGINT 类型、TINYINT 类型、BYTE 类型、SMALLINT 类型、BINARY 类型、VARBINARY 类型。</li>
<li><strong>近似数值类型包括</strong>：FLOAT 类型、DOUBLE 类型、REAL 类型、DOUBLE PRECISION 类型。</li>
</ul>
<p>NUMERIC 数据类型用于存储零、正负定点数。其中：精度是一个无符号整数，定义了总的数字数，精度范围是 1 至 38。标度定义了小数点右边的数字位数。一个数的标度不应大于其精度，如果实际标度大于指定标度，那么超出标度的位数将会四舍五入省去。</p>
<p>例如：<strong>NUMERIC(4,1) 定义了小数点前面 3 位和小数点后面 1 位，共 4 位的数字，范围在 -999.9 到 999.9</strong>。所有 NUMERIC 数据类型，如果其值超过精度，会返回一个出错信息，如果超过标度，则多余的位会被截断。</p>
<p>使用语法：NUMERIC[(精度 [, 标度])]，DECIMAL、DEC 类型、NUMBER 类型与 NUMERIC 的语法一致。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表，定义金额字段为 NUMERIC 类型，精度为 10, 标度为 2。即小数点前面 8 位，小数点后面 2 位</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dmhr.NUMERIC_TEST(</span><br><span class="line">        cust_id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">        amt <span class="type">NUMERIC</span>(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dmhr.NUMERIC_TEST <span class="keyword">values</span>(<span class="string">&#x27;10000001&#x27;</span>,<span class="string">&#x27;88888888.99&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dmhr.NUMERIC_TEST <span class="keyword">values</span>(<span class="string">&#x27;10000002&#x27;</span>,<span class="string">&#x27;-66666666.99&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="comment">-- 查询全部</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.NUMERIC_TEST;</span><br></pre></td></tr></table></figure>

<h3 id="常用聚集函数"><a href="#常用聚集函数" class="headerlink" title="常用聚集函数"></a>常用聚集函数</h3><p><strong>SQL 中的聚集函数共包括 5 个</strong> (MAX、MIN、SUM、AVG、COUNT)，可以帮我们求某列的最大值、最小值及平均值等。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个部门员工的平均薪资、最小薪资、最大薪资、总工资及总记录</span></span><br><span class="line"><span class="keyword">SELECT</span> job_id,</span><br><span class="line">    <span class="built_in">AVG</span> (salary) <span class="keyword">AS</span> 平均值,</span><br><span class="line">    <span class="built_in">MIN</span> (salary) <span class="keyword">AS</span> 最小值,</span><br><span class="line">    <span class="built_in">MAX</span> (salary) <span class="keyword">AS</span> 最大值,</span><br><span class="line">    <span class="built_in">SUM</span> (salary) <span class="keyword">AS</span> 工资合计,</span><br><span class="line">    <span class="built_in">COUNT</span> (<span class="operator">*</span>) <span class="keyword">AS</span> 总行数</span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当表中没有数据时，不加 group by 会返回一行数据，加了 group by 无数据返回。</p>
</blockquote>
<h3 id="生成累计和"><a href="#生成累计和" class="headerlink" title="生成累计和"></a>生成累计和</h3><p>使用分析函数 <strong>sum (…) over (order by…)</strong> 可以生成累计和。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按员工编号排序对员工的工资进行累加,用 listagg 模拟出每一行是哪些值相加</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id <span class="keyword">AS</span> 编号,</span><br><span class="line">    employee_name <span class="keyword">AS</span> 姓名,</span><br><span class="line">    salary <span class="keyword">AS</span> 人工成本,</span><br><span class="line">    <span class="built_in">SUM</span> (salary) <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> employee_id) <span class="keyword">AS</span> 成本累计,</span><br><span class="line">    ( <span class="keyword">SELECT</span> <span class="built_in">LISTAGG</span> (salary, <span class="string">&#x27;+&#x27;</span>) <span class="keyword">WITHIN</span> <span class="keyword">GROUP</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> employee_id) </span><br><span class="line">        <span class="keyword">FROM</span> dmhr.employee b <span class="keyword">WHERE</span> b.job_id <span class="operator">=</span> <span class="number">11</span> <span class="keyword">AND</span> b.employee_id <span class="operator">&lt;=</span> a.employee_id ) 计算公式</span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="number">11</span>;</span><br></pre></td></tr></table></figure>

<h3 id="求总和的百分比"><a href="#求总和的百分比" class="headerlink" title="求总和的百分比"></a>求总和的百分比</h3><p>使用分析函数 <code>SUM() 和 OVER()</code> 计算各部门工资合计及该合计工资占总工资的比例。用 <code>group by</code> 语句可以用到合计工资。</p>
<blockquote>
<p>当 OVER() 后不加任何内容时，就是对所有的数据进行汇总。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job_id, 工资合计, <span class="built_in">SUM</span> (工资合计) <span class="keyword">OVER</span> () <span class="keyword">AS</span> 总合计</span><br><span class="line"><span class="keyword">FROM</span> (  </span><br><span class="line">    <span class="keyword">SELECT</span> job_id, <span class="built_in">SUM</span> (salary) 工资合计 <span class="keyword">FROM</span> dmhr.employee <span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id</span><br><span class="line">) x;</span><br></pre></td></tr></table></figure>

<h2 id="位串数据类型-BIT"><a href="#位串数据类型-BIT" class="headerlink" title="位串数据类型 BIT"></a>位串数据类型 BIT</h2><ul>
<li>BIT 类型语法：BIT</li>
</ul>
<blockquote>
<p>BIT 类型用于存储整数数据 1、0 或 NULL，只有 0 才转换为假，其他非空、非 0 值都会自动转换为真，可以用来支持 ODBC 和 JDBC 的布尔数据类型。DM 的 BIT 类型与 SQL Server 2000 的 BIT 数据类型相似。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表，定义性别字段为 sex, 1-男，0-女</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dmhr.BIT_TEST(</span><br><span class="line">        cust_id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">        cust_name <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">        sex BIT</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dmhr.BIT_TEST <span class="keyword">values</span>(<span class="string">&#x27;10000001&#x27;</span>,<span class="string">&#x27;李丽&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dmhr.BIT_TEST <span class="keyword">values</span>(<span class="string">&#x27;10000002&#x27;</span>,<span class="string">&#x27;王强&#x27;</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<h2 id="日期时间数据类型"><a href="#日期时间数据类型" class="headerlink" title="日期时间数据类型"></a>日期时间数据类型</h2><p>日期时间数据类型分为一般日期时间数据类型、时间间隔数据类型和时区数据类型三类，用于存储日期、时间和它们之间的间隔信息。</p>
<ul>
<li><p>一般日期时间数据类型</p>
<p>DATE 类型包括年、月、日信息；TIME 类型包括时、分、秒信息；TIMESTAMP 类型包括年、月、日、时、分、秒信息。</p>
<blockquote>
<p>TIME 类型的小数秒精度规定了秒字段中小数点后面的位数，取值范围为 0～6，如果未定义，缺省精度为 0。 TIMESTAMP 类型的小数秒精度规定了秒字段中小数点后面的位数，取值范围为 0～6，如果未定义，缺省精度为 6。</p>
</blockquote>
</li>
<li><p>时间间隔数据类型</p>
<p>DM 支持两类时间间隔类型：年-月间隔类和日-时间隔类，它们通过时间间隔限定符区分，前者结合了日期字段年和月，后者结合了时间字段日、时、分、秒。时间间隔数据类型所描述的值是有符号的。</p>
<blockquote>
<p>使用时间间隔数据类型时，如果不指定精度，那么将使用默认精度 6。</p>
</blockquote>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表，定义 3 个日期时间数据类型，DATE、TIME 及 TIMESTAMP</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dmhr.DATE_TEST(</span><br><span class="line">        cust_id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">        goods <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">        pay_date <span class="type">DATE</span>,</span><br><span class="line">        pay_time <span class="type">TIME</span>（<span class="number">2</span>）,</span><br><span class="line">        pay_timestamp <span class="type">TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dmhr.DATE_TEST</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;10000001&#x27;</span>,<span class="string">&#x27;百事可乐&#x27;</span>,<span class="string">&#x27;2020-11-19&#x27;</span>,<span class="string">&#x27;23:59:59.99&#x27;</span>,<span class="string">&#x27;2020-11-19 23:59:59.999999&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dmhr.DATE_TEST</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;10000002&#x27;</span>,<span class="string">&#x27;可口可乐&#x27;</span>,<span class="string">&#x27;2020-11-18&#x27;</span>,<span class="string">&#x27;10:05:30.00&#x27;</span>,<span class="string">&#x27;2020-11-18 10:05:30.000000&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<h3 id="加减日、月、年"><a href="#加减日、月、年" class="headerlink" title="加减日、月、年"></a>加减日、月、年</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 根据某个员工的入职日计算其前五天、后五天、前五个月、后五个月、前五年及后5年的具体时间</span></span><br><span class="line"><span class="keyword">SELECT</span> hire_date <span class="keyword">AS</span> 聘用日期,</span><br><span class="line">   add_days (hire_date, <span class="number">-5</span>) <span class="keyword">AS</span> 减<span class="number">5</span>天,</span><br><span class="line">   add_days (hire_date, <span class="number">5</span>) <span class="keyword">AS</span> 加<span class="number">5</span>天,</span><br><span class="line">   add_months (hire_date, <span class="number">-5</span>) <span class="keyword">AS</span> 减<span class="number">5</span>月,</span><br><span class="line">   add_months (hire_date, <span class="number">5</span>) <span class="keyword">AS</span> 加<span class="number">5</span>月,</span><br><span class="line">   add_months (hire_date, <span class="number">-5</span> <span class="operator">*</span> <span class="number">12</span>) <span class="keyword">AS</span> 减<span class="number">5</span>年,</span><br><span class="line">   add_months (hire_date, <span class="number">5</span> <span class="operator">*</span> <span class="number">12</span>) <span class="keyword">AS</span> 加<span class="number">5</span>年</span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee</span><br><span class="line"><span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="加减时、分、秒"><a href="#加减时、分、秒" class="headerlink" title="加减时、分、秒"></a>加减时、分、秒</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 时间类型的数据可以直接加减时、分、秒，1/24 指的是 1 小时。</span></span><br><span class="line"><span class="keyword">select</span> sysdate <span class="keyword">as</span> 当前日期,</span><br><span class="line">    sysdate <span class="operator">-</span> <span class="number">5.0</span> <span class="operator">/</span> <span class="number">24</span> <span class="keyword">as</span> 减<span class="number">5</span>小时,</span><br><span class="line">    sysdate <span class="operator">+</span> <span class="number">5.0</span> <span class="operator">/</span> <span class="number">24</span> <span class="keyword">as</span> 加<span class="number">5</span>小时,</span><br><span class="line">    sysdate <span class="operator">-</span> <span class="number">5.0</span> <span class="operator">/</span> <span class="number">24</span> <span class="operator">/</span> <span class="number">60</span> <span class="keyword">as</span> 减<span class="number">5</span>分钟,</span><br><span class="line">    sysdate <span class="operator">+</span> <span class="number">5.0</span> <span class="operator">/</span> <span class="number">24</span> <span class="operator">/</span> <span class="number">60</span> <span class="keyword">as</span> 加<span class="number">5</span>分钟</span><br><span class="line"><span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<h3 id="日期间隔之时、分、秒"><a href="#日期间隔之时、分、秒" class="headerlink" title="日期间隔之时、分、秒"></a>日期间隔之时、分、秒</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 两个 date 相减，得到的是天数，乘以 24 即为小时，以此类推可计算出秒。</span></span><br><span class="line"><span class="keyword">SELECT</span> 间隔天数,</span><br><span class="line">   间隔天数 <span class="operator">*</span> <span class="number">24</span> <span class="keyword">AS</span> 间隔小时,</span><br><span class="line">   间隔天数 <span class="operator">*</span> <span class="number">24</span> <span class="operator">*</span> <span class="number">60</span> <span class="keyword">AS</span> 间隔分,</span><br><span class="line">   间隔天数 <span class="operator">*</span> <span class="number">24</span> <span class="operator">*</span> <span class="number">60</span> <span class="operator">*</span> <span class="number">60</span> <span class="keyword">AS</span> 间隔秒</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MAX</span> (hire_date) <span class="operator">-</span> <span class="built_in">MIN</span> (hire_date) <span class="keyword">AS</span> 间隔天数 </span><br><span class="line">    <span class="keyword">FROM</span> dmhr.employee </span><br><span class="line">    <span class="keyword">WHERE</span> employee_name <span class="keyword">IN</span> (<span class="string">&#x27;马学铭&#x27;</span>, <span class="string">&#x27;陈仙&#x27;</span>)</span><br><span class="line">) x;</span><br></pre></td></tr></table></figure>

<h3 id="日期间隔之日、月、年"><a href="#日期间隔之日、月、年" class="headerlink" title="日期间隔之日、月、年"></a>日期间隔之日、月、年</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 months_between 函数计算间隔月份，以此类推计算出间隔年。</span></span><br><span class="line"><span class="keyword">SELECT</span> max_hd <span class="operator">-</span> min_hd 间隔天,</span><br><span class="line">   MONTHS_BETWEEN (max_hd, min_hd) 间隔月,</span><br><span class="line">   MONTHS_BETWEEN (max_hd, min_hd) <span class="operator">/</span> <span class="number">12</span> 间隔年</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">MAX</span> (hire_date) max_hd, <span class="built_in">MIN</span> (hire_date) min_hd <span class="keyword">FROM</span> dmhr.employee</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="求两个日期间的工作天数"><a href="#求两个日期间的工作天数" class="headerlink" title="求两个日期间的工作天数"></a>求两个日期间的工作天数</h3><p>通过 <code>MAX()</code> 将原数据转为一行，枚举 2 个日期之间的天数，与 T500 做笛卡尔积枚举 30 天的所有日期，根据日期得到对应工作日信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> tmp <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> 日期, TO_CHAR (日期, <span class="string">&#x27;DY&#x27;</span>, <span class="string">&#x27;NLS_DATE_LANGUAGE = American&#x27;</span>) <span class="keyword">AS</span> dy</span><br><span class="line">    <span class="keyword">FROM</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> min_hd <span class="operator">+</span> (dmhr.t500.id <span class="operator">-</span> <span class="number">1</span>) <span class="keyword">AS</span> 日期</span><br><span class="line">        <span class="keyword">FROM</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="built_in">MIN</span> (hire_date) <span class="keyword">AS</span> min_hd, <span class="built_in">MAX</span> (hire_date) <span class="keyword">AS</span> max_hd</span><br><span class="line">            <span class="keyword">FROM</span> dmhr.employee</span><br><span class="line">            <span class="keyword">WHERE</span> employee_name <span class="keyword">IN</span> (<span class="string">&#x27;马学铭&#x27;</span>, <span class="string">&#x27;陈仙&#x27;</span>)</span><br><span class="line">        ) x, dmhr.t500</span><br><span class="line">        <span class="keyword">WHERE</span> dmhr.t500.id <span class="operator">&lt;=</span> ( (max_hd <span class="operator">-</span> min_hd) <span class="operator">+</span> <span class="number">1</span>)</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 过滤并汇总</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span> (<span class="operator">*</span>) <span class="keyword">FROM</span> tmp <span class="keyword">WHERE</span> dy <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;SAT&#x27;</span>, <span class="string">&#x27;SUN&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="求一年中周内各日期的天数"><a href="#求一年中周内各日期的天数" class="headerlink" title="求一年中周内各日期的天数"></a>求一年中周内各日期的天数</h3><p>比如，计算一年内有多少天是星期一，多少天是星期二等，可以按照如下步骤实现：</p>
<ul>
<li>取得大当前年度信息。</li>
<li>计算一年有多少天。</li>
<li>生成日期列表。</li>
<li>转换为对应的星期标识。</li>
<li>汇总统计。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> x0 <span class="keyword">AS</span> (<span class="keyword">SELECT</span> TO_DATE (<span class="string">&#x27;2020-01-01&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd&#x27;</span>) <span class="keyword">AS</span> 年初 <span class="keyword">FROM</span> DUAL),</span><br><span class="line">     x1 <span class="keyword">AS</span> (<span class="keyword">SELECT</span> 年初, ADD_MONTHS (年初, <span class="number">12</span>) <span class="keyword">AS</span> 下年初 <span class="keyword">FROM</span> x0),</span><br><span class="line">     x2 <span class="keyword">AS</span> (<span class="keyword">SELECT</span> 年初, 下年初, 下年初 <span class="operator">-</span> 年初 <span class="keyword">AS</span> 天数 <span class="keyword">FROM</span> x1),</span><br><span class="line">     x3 <span class="keyword">AS</span> (<span class="keyword">SELECT</span> 年初 <span class="operator">+</span> (LEVEL <span class="operator">-</span> <span class="number">1</span>) <span class="keyword">AS</span> 日期 <span class="keyword">FROM</span> x2 <span class="keyword">CONNECT</span> <span class="keyword">BY</span> LEVEL <span class="operator">&lt;=</span> 天数),</span><br><span class="line">     x4 <span class="keyword">AS</span> (<span class="keyword">SELECT</span> 日期, TO_CHAR (日期, <span class="string">&#x27;DY&#x27;</span>) <span class="keyword">AS</span> 星期 <span class="keyword">FROM</span> x3)</span><br><span class="line"><span class="keyword">SELECT</span> 星期, <span class="built_in">COUNT</span> (<span class="operator">*</span>) <span class="keyword">AS</span> 天数 <span class="keyword">FROM</span> x4 <span class="keyword">GROUP</span> <span class="keyword">BY</span> 星期;</span><br></pre></td></tr></table></figure>

<h3 id="确定当前记录和下一条记录之间相差的天数"><a href="#确定当前记录和下一条记录之间相差的天数" class="headerlink" title="确定当前记录和下一条记录之间相差的天数"></a>确定当前记录和下一条记录之间相差的天数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 lead() over() 分析函数，将下一条记录的雇佣日期作为当前行</span></span><br><span class="line"><span class="keyword">WITH</span> tmp <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> employee_id,employee_name,hire_date, <span class="built_in">LEAD</span> (hire_date) <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date) next_hd</span><br><span class="line">    <span class="keyword">FROM</span> dmhr.employee</span><br><span class="line">    <span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="number">11</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> employee_name,hire_date,next_hd,next_hd <span class="operator">-</span> hire_date diff <span class="keyword">FROM</span> tmp;</span><br></pre></td></tr></table></figure>

<h3 id="SYSDATE"><a href="#SYSDATE" class="headerlink" title="SYSDATE"></a>SYSDATE</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> hire_date,</span><br><span class="line">   TO_NUMBER (TO_CHAR (hire_date, <span class="string">&#x27;hh24&#x27;</span>)) 时,</span><br><span class="line">   TO_NUMBER (TO_CHAR (hire_date, <span class="string">&#x27;mi&#x27;</span>)) 分,</span><br><span class="line">   TO_NUMBER (TO_CHAR (hire_date, <span class="string">&#x27;ss&#x27;</span>)) 秒,</span><br><span class="line">   TO_NUMBER (TO_CHAR (hire_date, <span class="string">&#x27;dd&#x27;</span>)) 日,</span><br><span class="line">   TO_NUMBER (TO_CHAR (hire_date, <span class="string">&#x27;mm&#x27;</span>)) 月,</span><br><span class="line">   TO_NUMBER (TO_CHAR (hire_date, <span class="string">&#x27;yyyy&#x27;</span>)) 年,</span><br><span class="line">   TO_NUMBER (TO_CHAR (hire_date, <span class="string">&#x27;ddd&#x27;</span>)) 年内第几天,</span><br><span class="line">   TRUNC (hire_date, <span class="string">&#x27;dd&#x27;</span>) 一天之始,</span><br><span class="line">   TRUNC (hire_date, <span class="string">&#x27;day&#x27;</span>) 周初,</span><br><span class="line">   TRUNC (hire_date, <span class="string">&#x27;mm&#x27;</span>) 月初,</span><br><span class="line">   LAST_DAY (hire_date) 月末,</span><br><span class="line">   ADD_MONTHS (TRUNC (hire_date, <span class="string">&#x27;mm&#x27;</span>), <span class="number">1</span>) 下月初,</span><br><span class="line">   TRUNC (hire_date, <span class="string">&#x27;yy&#x27;</span>) 年初,</span><br><span class="line">   TO_CHAR (hire_date, <span class="string">&#x27;day&#x27;</span>) 周几,</span><br><span class="line">   TO_CHAR (hire_date, <span class="string">&#x27;month&#x27;</span>) 月份</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> hire_date <span class="operator">+</span> <span class="number">30</span> <span class="operator">/</span> <span class="number">24</span> <span class="operator">/</span> <span class="number">60</span> <span class="operator">/</span> <span class="number">60</span> <span class="operator">+</span> <span class="number">20</span> <span class="operator">/</span> <span class="number">24</span> <span class="operator">/</span> <span class="number">60</span> <span class="operator">+</span> <span class="number">5</span> <span class="operator">/</span> <span class="number">24</span> <span class="keyword">AS</span> hire_date</span><br><span class="line">  <span class="keyword">FROM</span> dmhr.employee</span><br><span class="line">  <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;=</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="EXTRACT"><a href="#EXTRACT" class="headerlink" title="EXTRACT"></a>EXTRACT</h3><p><code>EXTRACT</code> 函数可以提取时间字段中的年、月、日、时、分、秒，返回的值为 <strong>NUMBER</strong> 类型。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span> (<span class="keyword">YEAR</span> <span class="keyword">FROM</span> SYSTIMESTAMP) <span class="keyword">AS</span> &quot;YEAR&quot;,</span><br><span class="line">   <span class="built_in">EXTRACT</span> (<span class="keyword">MONTH</span> <span class="keyword">FROM</span> SYSTIMESTAMP) <span class="keyword">AS</span> &quot;MONTH&quot;,</span><br><span class="line">   <span class="built_in">EXTRACT</span> (<span class="keyword">DAY</span> <span class="keyword">FROM</span> SYSTIMESTAMP) <span class="keyword">AS</span> &quot;DAY&quot;,</span><br><span class="line">   <span class="built_in">EXTRACT</span> (<span class="keyword">HOUR</span> <span class="keyword">FROM</span> SYSTIMESTAMP) <span class="keyword">AS</span> &quot;HOUR&quot;,</span><br><span class="line">   <span class="built_in">EXTRACT</span> (<span class="keyword">MINUTE</span> <span class="keyword">FROM</span> SYSTIMESTAMP) <span class="keyword">AS</span> &quot;MINUTE&quot;,</span><br><span class="line">   <span class="built_in">EXTRACT</span> (<span class="keyword">SECOND</span> <span class="keyword">FROM</span> SYSTIMESTAMP) <span class="keyword">AS</span> &quot;SECOND&quot;</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>

<p><code>to_char</code> 函数可以用来取日期时间类型字段中的时、分、秒。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> created, TO_CHAR (created, <span class="string">&#x27;dd&#x27;</span>) <span class="keyword">AS</span> d, TO_CHAR (created, <span class="string">&#x27;hh24&#x27;</span>) <span class="keyword">AS</span> h</span><br><span class="line"><span class="keyword">FROM</span> dba_objects</span><br><span class="line"><span class="keyword">WHERE</span> object_id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p><code>EXTRACT</code> 函数可以用来取 <strong>INTERVAL</strong> 中的信息，<code>to_char</code> 函数不支持。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span> (<span class="keyword">HOUR</span> <span class="keyword">FROM</span> it) <span class="keyword">AS</span> &quot;hour&quot;</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="type">INTERVAL</span> <span class="string">&#x27;2 12:30:59&#x27;</span> <span class="keyword">DAY</span> <span class="keyword">TO</span> <span class="keyword">SECOND</span> <span class="keyword">AS</span> it <span class="keyword">FROM</span> DUAL);</span><br></pre></td></tr></table></figure>

<h3 id="判断一年是否为闰年"><a href="#判断一年是否为闰年" class="headerlink" title="判断一年是否为闰年"></a>判断一年是否为闰年</h3><p>判断一年是否为闰年，可以看二月的月末具体是哪一天。使用 <code>TO_CHAR、 LAST_DAY、 ADD_MONTHS、 TRUNC</code> 函数共同实现。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 计算年初</span></span><br><span class="line"><span class="keyword">SELECT</span> TRUNC (hire_date, <span class="string">&#x27;y&#x27;</span>) 年初 </span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 计算二月初</span></span><br><span class="line"><span class="keyword">SELECT</span> ADD_MONTHS (TRUNC (hire_date, <span class="string">&#x27;y&#x27;</span>), <span class="number">1</span>) 二月初 </span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 计算二月底</span></span><br><span class="line"><span class="keyword">SELECT</span> LAST_DAY (ADD_MONTHS (TRUNC (hire_date, <span class="string">&#x27;y&#x27;</span>), <span class="number">1</span>)) <span class="keyword">AS</span> 二月底 </span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 计算二月底对应的日期</span></span><br><span class="line"><span class="keyword">SELECT</span> TO_CHAR (LAST_DAY (ADD_MONTHS (TRUNC (hire_date, <span class="string">&#x27;y&#x27;</span>), <span class="number">1</span>)), <span class="string">&#x27;DD&#x27;</span>) <span class="keyword">AS</span> 日</span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="周的计算"><a href="#周的计算" class="headerlink" title="周的计算"></a>周的计算</h3><p>使用 <code>TO_CHAR、 NEXT_DAY、TRUNC</code> 函数共同实现周的计算。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> x <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> TRUNC (SYSDATE, <span class="string">&#x27;yy&#x27;</span>) <span class="operator">+</span> (LEVEL <span class="operator">-</span> <span class="number">1</span>) <span class="keyword">AS</span> 日期 <span class="keyword">FROM</span> DUAL <span class="keyword">CONNECT</span> <span class="keyword">BY</span> LEVEL <span class="operator">&lt;=</span> <span class="number">8</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> 日期,</span><br><span class="line">   TO_CHAR (日期, <span class="string">&#x27;d&#x27;</span>) <span class="keyword">AS</span> d,</span><br><span class="line">   TO_CHAR (日期, <span class="string">&#x27;day&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">day</span>,</span><br><span class="line">   NEXT_DAY (日期, <span class="number">1</span>) <span class="keyword">AS</span> 下个周日,</span><br><span class="line">   TO_CHAR (日期, <span class="string">&#x27;ww&#x27;</span>) <span class="keyword">AS</span> ww,</span><br><span class="line">   TO_CHAR (日期, <span class="string">&#x27;iw&#x27;</span>) <span class="keyword">AS</span> iw</span><br><span class="line"><span class="keyword">FROM</span> x;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong>：参数 “day” 与字符集无关，所以建议使用 “d”。 WW 与 IW 都是取 “第几周”，只是两个参数的初始值不一样。</p>
</blockquote>
<h3 id="确定一年内属于周内某一天的所有日期"><a href="#确定一年内属于周内某一天的所有日期" class="headerlink" title="确定一年内属于周内某一天的所有日期"></a>确定一年内属于周内某一天的所有日期</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回指定年份内的所有周五对应的日期。</span></span><br><span class="line"><span class="keyword">WITH</span> x <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> TRUNC (SYSDATE, <span class="string">&#x27;yy&#x27;</span>) <span class="operator">+</span> (LEVEL <span class="operator">-</span> <span class="number">1</span>) dy </span><br><span class="line">    <span class="keyword">FROM</span> DUAL <span class="keyword">CONNECT</span> <span class="keyword">BY</span> LEVEL <span class="operator">&lt;=</span> ADD_MONTHS (TRUNC (SYSDATE, <span class="string">&#x27;y&#x27;</span>), <span class="number">12</span>) <span class="operator">-</span> TRUNC (SYSDATE, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> dy, TO_CHAR (dy, <span class="string">&#x27;day&#x27;</span>) <span class="keyword">AS</span> 周五 <span class="keyword">FROM</span> x <span class="keyword">WHERE</span> TO_CHAR (dy, <span class="string">&#x27;d&#x27;</span>) <span class="operator">=</span> <span class="number">6</span>;</span><br></pre></td></tr></table></figure>

<h3 id="确定某月内第一个和最后一个周末某天的日期"><a href="#确定某月内第一个和最后一个周末某天的日期" class="headerlink" title="确定某月内第一个和最后一个周末某天的日期"></a>确定某月内第一个和最后一个周末某天的日期</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回当月内第一个星期一与最后一个星期一，分别找上月某及当月末之前七天的下一周的周一即可</span></span><br><span class="line"><span class="keyword">SELECT</span> NEXT_DAY (TRUNC (hire_date, <span class="string">&#x27;mm&#x27;</span>) <span class="operator">-</span> <span class="number">1</span>, <span class="number">2</span>) 第一个周一,</span><br><span class="line">       NEXT_DAY (LAST_DAY (TRUNC (hire_date, <span class="string">&#x27;mm&#x27;</span>)) <span class="operator">-</span> <span class="number">7</span>, <span class="number">2</span>) 最后一个周一</span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee</span><br><span class="line"><span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="创建本月日历"><a href="#创建本月日历" class="headerlink" title="创建本月日历"></a>创建本月日历</h3><p>枚举指定月份所有的日期，并转换为对应的周信息，再按所在周做一次 <strong>行转列</strong> 即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 给定一个日期</span></span><br><span class="line"><span class="keyword">WITH</span> x1 <span class="keyword">AS</span> ( <span class="keyword">SELECT</span> TO_DATE(<span class="string">&#x27;2020-11-01&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd&#x27;</span>) <span class="keyword">AS</span> cur_date <span class="keyword">FROM</span> DUAL ),</span><br><span class="line">     <span class="comment">-- 取月初</span></span><br><span class="line">     x2 <span class="keyword">AS</span> ( <span class="keyword">SELECT</span> TRUNC(cur_date, <span class="string">&#x27;mm&#x27;</span>) <span class="keyword">AS</span> 月初, ADD_MONTHS(TRUNC(cur_date, <span class="string">&#x27;mm&#x27;</span>), <span class="number">1</span>) <span class="keyword">AS</span> 下月初 <span class="keyword">FROM</span> x1 ),</span><br><span class="line">     <span class="comment">-- 枚举当月所有天</span></span><br><span class="line">     x3 <span class="keyword">AS</span> ( <span class="keyword">SELECT</span> 月初 <span class="operator">+</span> (LEVEL <span class="operator">-</span> <span class="number">1</span>) <span class="keyword">AS</span> 日 <span class="keyword">FROM</span> x2 <span class="keyword">CONNECT</span> <span class="keyword">BY</span> LEVEL <span class="operator">&lt;=</span> (下月初 <span class="operator">-</span> 月初) ),</span><br><span class="line">     <span class="comment">-- 提取周信息</span></span><br><span class="line">     x4 <span class="keyword">AS</span> ( <span class="keyword">SELECT</span> TO_CHAR(日,<span class="string">&#x27;iw&#x27;</span>) 所在周, TO_CHAR(日,<span class="string">&#x27;dd&#x27;</span>) 日期, TO_NUMBER(TO_CHAR(日,<span class="string">&#x27;d&#x27;</span>)) 周几 <span class="keyword">FROM</span> x3 )</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="built_in">MAX</span> (<span class="keyword">CASE</span> 周几 <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> 日期 <span class="keyword">END</span>) 周一,</span><br><span class="line">    <span class="built_in">MAX</span> (<span class="keyword">CASE</span> 周几 <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> 日期 <span class="keyword">END</span>) 周二,</span><br><span class="line">    <span class="built_in">MAX</span> (<span class="keyword">CASE</span> 周几 <span class="keyword">WHEN</span> <span class="number">4</span> <span class="keyword">THEN</span> 日期 <span class="keyword">END</span>) 周三,</span><br><span class="line">    <span class="built_in">MAX</span> (<span class="keyword">CASE</span> 周几 <span class="keyword">WHEN</span> <span class="number">5</span> <span class="keyword">THEN</span> 日期 <span class="keyword">END</span>) 周四,</span><br><span class="line">    <span class="built_in">MAX</span> (<span class="keyword">CASE</span> 周几 <span class="keyword">WHEN</span> <span class="number">6</span> <span class="keyword">THEN</span> 日期 <span class="keyword">END</span>) 周五,</span><br><span class="line">    <span class="built_in">MAX</span> (<span class="keyword">CASE</span> 周几 <span class="keyword">WHEN</span> <span class="number">7</span> <span class="keyword">THEN</span> 日期 <span class="keyword">END</span>) 周六,</span><br><span class="line">    <span class="built_in">MAX</span> (<span class="keyword">CASE</span> 周几 <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> 日期 <span class="keyword">END</span>) 周日</span><br><span class="line"><span class="keyword">FROM</span> x4 <span class="keyword">GROUP</span> <span class="keyword">BY</span> 所在周 <span class="keyword">ORDER</span> <span class="keyword">BY</span> 所在周;</span><br></pre></td></tr></table></figure>

<h3 id="确定指定年份季度的开始日期和结束日期"><a href="#确定指定年份季度的开始日期和结束日期" class="headerlink" title="确定指定年份季度的开始日期和结束日期"></a>确定指定年份季度的开始日期和结束日期</h3><p>按季度分类汇总，提取对应的季度开始日期和结束日期。可以通过 <strong>add_months、to_date</strong> 函数实现。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sn <span class="keyword">AS</span> 季度,</span><br><span class="line">   (sn <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> <span class="number">3</span> <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> 开始月份,</span><br><span class="line">   ADD_MONTHS (TO_DATE (年, <span class="string">&#x27;yyyy&#x27;</span>), (sn <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> <span class="number">3</span>) <span class="keyword">AS</span> 开始日期,</span><br><span class="line">   ADD_MONTHS (TO_DATE (年, <span class="string">&#x27;yyyy&#x27;</span>), sn <span class="operator">*</span> <span class="number">3</span>) <span class="operator">-</span> <span class="number">1</span> <span class="keyword">AS</span> 结束日期</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="string">&#x27;2020&#x27;</span> <span class="keyword">AS</span> 年, LEVEL <span class="keyword">AS</span> sn <span class="keyword">FROM</span> DUAL <span class="keyword">CONNECT</span> <span class="keyword">BY</span> LEVEL <span class="operator">&lt;=</span> <span class="number">4</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="按照给定的时间单位查找"><a href="#按照给定的时间单位查找" class="headerlink" title="按照给定的时间单位查找"></a>按照给定的时间单位查找</h3><p>使用 to_char 函数查询给定时间单位的时间。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询如入职日期在 1 月或者 12 月且非星期三的员工信息。</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_name 姓名, hire_date 入职日期, TO_CHAR (hire_date, <span class="string">&#x27;day&#x27;</span>) <span class="keyword">AS</span> 星期</span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee</span><br><span class="line"><span class="keyword">WHERE</span> TO_CHAR (hire_date, <span class="string">&#x27;mm&#x27;</span>) <span class="keyword">IN</span> (<span class="string">&#x27;01&#x27;</span>, <span class="string">&#x27;12&#x27;</span>) <span class="keyword">AND</span> TO_CHAR (hire_date, <span class="string">&#x27;d&#x27;</span>) <span class="operator">!=</span> <span class="string">&#x27;4&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="使用日期的特殊部分比较记录"><a href="#使用日期的特殊部分比较记录" class="headerlink" title="使用日期的特殊部分比较记录"></a>使用日期的特殊部分比较记录</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 to_char 函数统计相同月份与周内日期入职的员工。</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_name 姓名, hire_date 入职日期, TO_CHAR (hire_date, <span class="string">&#x27;MON day&#x27;</span>) <span class="keyword">AS</span> 月周</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> employee_name, hire_date, <span class="built_in">COUNT</span> (<span class="operator">*</span>) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> TO_CHAR (hire_date, <span class="string">&#x27;MON day&#x27;</span>)) <span class="keyword">AS</span> ct</span><br><span class="line">    <span class="keyword">FROM</span> dmhr.employee</span><br><span class="line">)</span><br><span class="line"><span class="keyword">WHERE</span> hire_date <span class="keyword">LIKE</span> <span class="string">&#x27;2015%&#x27;</span>;</span><br></pre></td></tr></table></figure>





<h2 id="多媒体数据类型"><a href="#多媒体数据类型" class="headerlink" title="多媒体数据类型"></a>多媒体数据类型</h2><p>多媒体数据类型的字值有两种格式：一是字符串，例如：’ABCD’，二是 BINARY，如 0x61626364。</p>
<p>多媒体数据类型包括：</p>
<ul>
<li>TEXT/LONG/LONGVARCHAR 类型：变长字符串类型。其字符串的长度最大为 100G-1，用于存储长的文本串。</li>
<li>IMAGE/LONGVARBINARY 类型：用于指明多媒体信息中的图像类型，长度最大为 100G-1 字节。</li>
<li>BLOB 类型：用于指明变长的<strong>二进制</strong>大对象，长度最大为 100G-1 字节。</li>
<li>CLOB 类型：用于指明变长的字母数字字符串，长度最大为 100G-1 字节。</li>
<li>BFILE 类型：用于指明存储在操作系统中的<strong>二进制</strong>文件。</li>
</ul>
<blockquote>
<p>BLOB 和 IMAGE 类型的字段内容必须存储十六进制的数字串内容</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表，定义多个多媒体数据类型字段，c1，c3长文本，c2，c4二进制数据</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dmhr.TEXT_TEST(</span><br><span class="line">        c1 TEXT,</span><br><span class="line">        c2 <span class="type">BLOB</span>,</span><br><span class="line">        c3 <span class="type">CLOB</span>,</span><br><span class="line">        c4 IMAGE</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dmhr.TEXT_TEST <span class="keyword">values</span>(<span class="string">&#x27;dameng&#x27;</span>,<span class="string">&#x27;0x123456789&#x27;</span>,<span class="string">&#x27;clob&#x27;</span>,<span class="string">&#x27;0x987654321&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="单表查询-SQL-操作方法"><a href="#单表查询-SQL-操作方法" class="headerlink" title="单表查询 SQL 操作方法"></a>单表查询 SQL 操作方法</h1><h2 id="查看表结构"><a href="#查看表结构" class="headerlink" title="查看表结构"></a>查看表结构</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DBMS_METADATA.GET_DDL(<span class="string">&#x27;TABLE&#x27;</span>,<span class="string">&#x27;EMPLOYEE&#x27;</span>,<span class="string">&#x27;DMHR&#x27;</span>) <span class="keyword">FROM</span> dual;</span><br><span class="line">SP_TABLEDEF(<span class="string">&#x27;DMHR&#x27;</span>,<span class="string">&#x27;EMPLOYEE&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="全表数据检索"><a href="#全表数据检索" class="headerlink" title="全表数据检索"></a>全表数据检索</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.employee;</span><br></pre></td></tr></table></figure>

<h2 id="行过滤"><a href="#行过滤" class="headerlink" title="行过滤"></a>行过滤</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按员工入职时间进行筛选</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> hire_date <span class="operator">&gt;</span> <span class="string">&#x27;2015-01-01&#x27;</span>;</span><br><span class="line"><span class="comment">-- 查找满足多个条件的行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.employee</span><br><span class="line"><span class="keyword">WHERE</span> (department_id <span class="operator">=</span> <span class="number">102</span> <span class="keyword">OR</span> salary <span class="operator">&gt;</span> <span class="number">20000</span> <span class="keyword">OR</span> (department_id <span class="operator">=</span> <span class="number">105</span> <span class="keyword">AND</span> salary <span class="operator">&gt;</span> <span class="number">9000</span>));</span><br></pre></td></tr></table></figure>

<h2 id="空值"><a href="#空值" class="headerlink" title="空值"></a>空值</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>  <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>NULL 不支持加、减、乘、除、大小、相等比较，所有查询结果都为空。在处理空值之前，需要把空值改为有意义的值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_name, employee_id, NVL (commission_pct, <span class="number">0</span>) <span class="keyword">AS</span> commission_pct <span class="keyword">FROM</span> dmhr.employee;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>转换函数 (nvl)，只能转换 null 值为同类型或者可以隐式转换成同类型的值。</p>
</blockquote>
<p>函数对空值的处理方式各不一样，返回结果不同：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回空值</span></span><br><span class="line"><span class="keyword">SELECT</span> GREATEST(<span class="number">16</span>,<span class="keyword">NULL</span>) <span class="keyword">FROM</span> dual;</span><br><span class="line"><span class="comment">-- 返回预期的值</span></span><br><span class="line"><span class="keyword">SELECT</span> REPLACE(<span class="string">&#x27;123456&#x27;</span>,<span class="number">3</span>,<span class="keyword">NULL</span>) <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>

<h2 id="临时表"><a href="#临时表" class="headerlink" title="临时表"></a>临时表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> x <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> ROWNUM <span class="keyword">AS</span> seq, a.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> (  <span class="keyword">SELECT</span> 编号, 项目, 金额 <span class="keyword">FROM</span> dmhr.detail <span class="keyword">ORDER</span> <span class="keyword">BY</span> 编号) a</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> x;</span><br></pre></td></tr></table></figure>

<h2 id="列别名及部分列检索"><a href="#列别名及部分列检索" class="headerlink" title="列别名及部分列检索"></a>列别名及部分列检索</h2><p>列名通常是英文表示，所以可以给列取个别名，增强可读性。可使用 <code>as</code> 关键字或直接跟别名。示例语句如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 as 关键字或直接跟别名</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id <span class="keyword">AS</span> &quot;员工编号&quot;, employee_name <span class="keyword">AS</span> &quot;员工姓名&quot; <span class="keyword">FROM</span> dmhr.employee;</span><br><span class="line"><span class="comment">-- 检索部分列需要明确指定要查询的列，而不是用 * 号替代</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, employee_name, salary <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">20000</span>;</span><br></pre></td></tr></table></figure>

<h2 id="where-子句中引用别名列"><a href="#where-子句中引用别名列" class="headerlink" title="where 子句中引用别名列"></a>where 子句中引用别名列</h2><p>where 条件引用别名一定要嵌套一层，因为别名是在 select 之后才有效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> employee_id emid, email emna, salary sal <span class="keyword">FROM</span> dmhr.employee) <span class="keyword">WHERE</span> sal <span class="operator">&gt;</span> <span class="number">10000</span>;</span><br></pre></td></tr></table></figure>

<h2 id="列拼接"><a href="#列拼接" class="headerlink" title="列拼接"></a>列拼接</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 || 可以把字符串拼接起来</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_name <span class="operator">||</span> <span class="string">&#x27; salary is &#x27;</span> <span class="operator">||</span> salary <span class="keyword">AS</span> col1 <span class="keyword">FROM</span> dmhr.employee;</span><br><span class="line"><span class="comment">-- 也可以将需要批量执行的 SQL 语句拼接起来</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;TRUNCATE TABLE &#x27;</span> <span class="operator">||</span> schema_name <span class="operator">||</span> <span class="string">&#x27;.&#x27;</span> <span class="operator">||</span> table_name <span class="keyword">FROM</span> ALL_TABLES_DIS_INFO </span><br><span class="line"><span class="keyword">WHERE</span> schema_name <span class="operator">=</span> <span class="string">&#x27;DMHR&#x27;</span>;</span><br><span class="line"><span class="comment">-- 字符串连接符 || 也可以改成 concat 函数</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT (<span class="string">&#x27;ABC&#x27;</span>,<span class="string">&#x27;BCD&#x27;</span>,<span class="string">&#x27;DDD&#x27;</span>,<span class="string">&#x27;BBB&#x27;</span>) <span class="keyword">AS</span> &quot;OUTPUT&quot; <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>

<h2 id="条件逻辑"><a href="#条件逻辑" class="headerlink" title="条件逻辑"></a>条件逻辑</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    employee_name,</span><br><span class="line">    salary,</span><br><span class="line">    <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> salary <span class="operator">&lt;=</span> <span class="number">4000</span>  <span class="keyword">THEN</span> <span class="string">&#x27;low&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">12000</span> <span class="keyword">THEN</span> <span class="string">&#x27;high&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;ok&#x27;</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">AS</span> salary_status</span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee;</span><br></pre></td></tr></table></figure>

<h2 id="限制返回的行数"><a href="#限制返回的行数" class="headerlink" title="限制返回的行数"></a>限制返回的行数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在查询的时候并不是每次都要求返回所有的行，比如抽查的时候只要求返回 10 行，可以使用伪列 `rownum` 来过滤</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> ROWNUM <span class="keyword">AS</span> rn, t.<span class="operator">*</span> <span class="keyword">FROM</span> dmhr.employee t <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;=</span> <span class="number">10</span>)</span><br><span class="line"><span class="keyword">WHERE</span> rn <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">-- 使用 LIMIT 子句返回两行</span></span><br><span class="line"><span class="keyword">SELECT</span>  <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.employee LIMIT <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h2 id="查询结果排序"><a href="#查询结果排序" class="headerlink" title="查询结果排序"></a>查询结果排序</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按子串排序、字符串替换、字符串混合排序及按指定列排序。</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_name, hire_date <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date <span class="keyword">ASC</span>;</span><br><span class="line">…………<span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date <span class="keyword">ASC</span>; <span class="comment">-- 按照列名排序</span></span><br><span class="line">…………<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span> <span class="keyword">ASC</span>; <span class="comment">-- 列名替换成数字，按第二列进行升序排序</span></span><br><span class="line">…………<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span> <span class="keyword">ASC</span>, <span class="number">3</span> <span class="keyword">DESC</span>; <span class="comment">-- 按多个字段排序</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>多列排序，若前面的列有重复，后面的排序才有用。即先通过前面的列将数据分组，再按照后面的列进行排序。</p>
</blockquote>
<h3 id="按子串排序"><a href="#按子串排序" class="headerlink" title="按子串排序"></a>按子串排序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> EMPLOYEE_NAME <span class="keyword">AS</span> 姓名, SUBSTR (PHONE_NUM, <span class="number">-4</span>) <span class="keyword">AS</span> 尾号 <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="TRANSLATE-应用"><a href="#TRANSLATE-应用" class="headerlink" title="TRANSLATE 应用"></a>TRANSLATE 应用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 实现字符替换</span></span><br><span class="line"><span class="built_in">TRANSLATE</span>(expr,from_string,to_string)</span><br><span class="line"><span class="comment">-- from_string 与 to_string 以字符为单位，对应字符逐个替换</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRANSLATE</span> (<span class="string">&#x27;ab你好bcadefg&#x27;</span>, <span class="string">&#x27;abcdefg&#x27;</span>, <span class="string">&#x27;1234567&#x27;</span>) <span class="keyword">AS</span> new_str <span class="keyword">FROM</span> DUAL; <span class="comment">-- 输出 12你好2314567</span></span><br><span class="line"><span class="comment">-- 如果 to_string 为空，则直接返回空值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRANSLATE</span>(<span class="string">&#x27;ab你好bcadefg&#x27;</span>,<span class="string">&#x27;abcdefg&#x27;</span>,<span class="string">&#x27;&#x27;</span>) <span class="keyword">AS</span> new_str <span class="keyword">FROM</span> DUAL; <span class="comment">-- 输出 NULL</span></span><br><span class="line"><span class="comment">-- 如果 to_string 对应的位置没有字符，from_string 中列出的字符将会被删除</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRANSLATE</span>(<span class="string">&#x27;ab你好bcadefg&#x27;</span>,<span class="string">&#x27;1abcdefg&#x27;</span>,<span class="string">&#x27;1&#x27;</span>) <span class="keyword">AS</span> new_str <span class="keyword">FROM</span> DUAL;  <span class="comment">--输出 你好</span></span><br></pre></td></tr></table></figure>

<h3 id="按数字和字母混合字符串中的字母排序"><a href="#按数字和字母混合字符串中的字母排序" class="headerlink" title="按数字和字母混合字符串中的字母排序"></a>按数字和字母混合字符串中的字母排序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 为了实现混合字符串排序，首先需创建视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> v <span class="keyword">AS</span></span><br><span class="line">   <span class="keyword">SELECT</span> postal_code <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span> city_id <span class="keyword">AS</span> data <span class="keyword">FROM</span> dmhr.location;</span><br><span class="line"><span class="comment">-- 查询视图信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> v;</span><br><span class="line"><span class="comment">-- 使用 translate 替换功能，把数字和空格都替换为空，然后再进行排序</span></span><br><span class="line"><span class="keyword">SELECT</span> data, <span class="built_in">TRANSLATE</span> (data, <span class="string">&#x27;- 0123456789&#x27;</span>, <span class="string">&#x27;-&#x27;</span>) <span class="keyword">AS</span> oper_type <span class="keyword">FROM</span> v <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;</span> <span class="number">5</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="按指定条件排序"><a href="#按指定条件排序" class="headerlink" title="按指定条件排序"></a>按指定条件排序</h3><p>如需将工资在 6000~8000 之间的员工排列在靠前位置，以便优先查看。可以在查询中新生成一列，实现指定条件排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    job_title <span class="keyword">AS</span> 职务,</span><br><span class="line">    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> min_salary <span class="operator">&gt;=</span> <span class="number">6000</span> <span class="keyword">AND</span> min_salary <span class="operator">&lt;=</span> <span class="number">8000</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">2</span> <span class="keyword">END</span> <span class="keyword">AS</span> 级别,</span><br><span class="line">    min_salary <span class="keyword">AS</span> 工资</span><br><span class="line"><span class="keyword">FROM</span> dmhr.job <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span>, <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<h2 id="范围处理"><a href="#范围处理" class="headerlink" title="范围处理"></a>范围处理</h2><p>语法：<code>lead(列名,n,m) over(partition by ... order by ...)</code>，不带参数 n，m，则查找当前记录后面第一行的记录列名的值。</p>
<ul>
<li>lead() 只能用于取后面第 n 行记录说明，不能取前面的。如果要取前面第 n 行记录说明，使用 lag（）函数。</li>
<li>over() 在什么条件之上，使用语法 over(partition by…order by…)。</li>
<li>partition by 按某个字段划分组。</li>
<li>order by 按某个字段排序。</li>
</ul>
<blockquote>
<p>可以使用分析函数 <code>lead() over()</code> 定位某一段连续值的范围。</p>
<p>可以使用分析函数 <code>lead() over()</code> 查找同一分区中行之间的差。</p>
<p>定位连续范围的起始点</p>
<p>详见 <a target="_blank" rel="noopener" href="https://eco.dameng.com/document/dm/zh-cn/sql-dev/practice-range-opeartion.html">达梦技术文档-范围处理</a></p>
</blockquote>
<hr>
<h1 id="多表查询-SQL-操作方法"><a href="#多表查询-SQL-操作方法" class="headerlink" title="多表查询 SQL 操作方法"></a>多表查询 SQL 操作方法</h1><h2 id="union-all"><a href="#union-all" class="headerlink" title="union all"></a>union all</h2><h3 id="union-all-与空字符串"><a href="#union-all-与空字符串" class="headerlink" title="union all 与空字符串"></a>union all 与空字符串</h3><p>使用 <code>union</code> 或者 <code>union all</code> 关键字合并多个结果集时，对应的列数必须一致，列的数据类型必须匹配。当其中一个结果集的列数不满足要求时，可以使用 <code>NULL</code> 或者 <code>空字符串</code> 填充。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 NULL 填充</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_name, department_id <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;DM2021&#x27;</span>, <span class="keyword">NULL</span> <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="comment">-- 使用空字符串填充</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_name, department_id <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;DM2021&#x27;</span>, <span class="string">&#x27;&#x27;</span> <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果存在 order by 子句，必须添加到 union 和 union all 的最后。</p>
</blockquote>
<h3 id="union-all-与-or"><a href="#union-all-与-or" class="headerlink" title="union all 与 or"></a>union all 与 or</h3><p>union all 用于合并两个结果集。比如姓名为常鹏程的员工编号是 2002，所有 or 查询是正确的，但 union all 却重复了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">2002</span> <span class="keyword">OR</span> employee_name <span class="operator">=</span> <span class="string">&#x27;常鹏程&#x27;</span>;</span><br><span class="line"><span class="comment">------ 等同于 ------</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">2002</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> employee_name <span class="operator">=</span> <span class="string">&#x27;常鹏程&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用 union all 替换 or，执行计划更高效，出现重复行时，使用 union 去重。</p>
<p>union 与去重：union 也用于合并两个结果集，同时去重。union 相当于对 union all 的输出结果再执行一次 DISTINCT 操作。</p>
</blockquote>
<h2 id="差集函数"><a href="#差集函数" class="headerlink" title="差集函数"></a>差集函数</h2><p><code>EXCEPT</code> 用于从一个表（原表）里查找出某个目标表里不存在的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id <span class="keyword">FROM</span> dmhr.dept <span class="keyword">EXCEPT</span> <span class="keyword">SELECT</span> department_id <span class="keyword">FROM</span> dmhr.employee;</span><br></pre></td></tr></table></figure>

<p>EXCEPT 获取第一个结果集的数据，然后排除第二个结果集的数据，类似减法运算</p>
<h2 id="IN、NOT-IN、EXISTS"><a href="#IN、NOT-IN、EXISTS" class="headerlink" title="IN、NOT IN、EXISTS"></a>IN、NOT IN、EXISTS</h2><p>查询含有 null 值的行时，如果包含 IN、NOT IN 要注意两者的区别。IN 相当于 OR, 而 NOT IN 相当于 AND。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (<span class="number">1002</span>, <span class="number">1005</span>, <span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.employee <span class="keyword">WHERE</span> employee_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">1002</span>, <span class="number">1005</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<p>第二句执行后返回记录为空，因为 NOT IN 的逻辑是 1002 AND 1005 AND NULL。当 NOT IN 后面跟的子查询返回的列存在 NULL 值，可能得不到正确的结果。</p>
<h2 id="连接类型"><a href="#连接类型" class="headerlink" title="连接类型"></a>连接类型</h2><p>连接包括：内连接、左连接、右连接、全连接、自连接 5 种类型，以上连接类型 DM 数据库都支持。</p>
<ul>
<li><p>内连接：结果完全满足连接条件的记录。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tab1.col1, tab2.col2 <span class="keyword">FROM</span> tab1, tab2 <span class="keyword">WHERE</span> tab1.id <span class="operator">=</span> tab2.tab1_id;</span><br><span class="line"><span class="keyword">SELECT</span> tab1.col1, tab2.col2 <span class="keyword">FROM</span> tab1 <span class="keyword">JOIN</span> tab2 <span class="keyword">ON</span> (tab1.id <span class="operator">=</span> tab2.tab1_id);</span><br></pre></td></tr></table></figure></li>
<li><p>左外连接：结果不仅包含满足条件的记录，还包含位于左表中不满足条件的记录，此时右表的记录显示为 NULL。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tab1.col1, tab2.col2 <span class="keyword">FROM</span> tab1 <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> tab2 <span class="keyword">ON</span> (tab1.id <span class="operator">=</span> tab2.tab1_id);</span><br></pre></td></tr></table></figure></li>
<li><p>右外连接：结果不仅包含满足条件的记录，还包含位于右表中不满足条件的记录，对应的左表的记录显示为 NULL。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tab1.col1, tab2.col2 <span class="keyword">FROM</span> tab1 <span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> tab2 <span class="keyword">ON</span> (tab1.id <span class="operator">=</span> tab2.tab1_id);</span><br></pre></td></tr></table></figure></li>
<li><p>全外连接：结果不仅包含满足条件的记录，还会包含位于两边表中所有不满足条件的记录，对应的两边表的记录显示为 NULL。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tab1.col1, tab2.col2 <span class="keyword">FROM</span> tab1 <span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> tab2 <span class="keyword">ON</span> (tab1.id <span class="operator">=</span> tab2.tab1_id);</span><br></pre></td></tr></table></figure></li>
<li><p>自连接：表和自身进行连接。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> je.employee_name, je.department_id, d.employee_name</span><br><span class="line"><span class="keyword">FROM</span> dmhr.employee je, dmhr.employee d</span><br><span class="line"><span class="keyword">WHERE</span> (je.manager_id <span class="operator">=</span> d.employee_id);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>自连接查询至少要对一张表起别名，否则，服务器无法识别要处理的是哪张表。</p>
</blockquote>
</li>
</ul>
<hr>
<h1 id="数据操纵"><a href="#数据操纵" class="headerlink" title="数据操纵"></a>数据操纵</h1><h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><h3 id="单表插入"><a href="#单表插入" class="headerlink" title="单表插入"></a>单表插入</h3><p>插入一行或多行数据，或按指定列插入行和 MySQL 语法一样。</p>
<p>按指定列插入行，未指定值的列上若定义了默认值，则插入默认值。没有指定默认值，为 NULL，则插入 NULL 值。</p>
<h3 id="多表插入"><a href="#多表插入" class="headerlink" title="多表插入"></a>多表插入</h3><p>一次性向两张表中插入多条数据，存在默认值同样可以省略。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">ALL</span></span><br><span class="line">  <span class="keyword">INTO</span> dmhr.t1 (id,name,class_id,tp)</span><br><span class="line">  <span class="keyword">INTO</span> dmhr.t2 (id,name,class_id,tp)</span><br><span class="line">       <span class="keyword">SELECT</span> dmhr.seq_id.nextval, DBMS_RANDOM.STRING(<span class="string">&#x27;X&#x27;</span>,<span class="number">4</span>), <span class="built_in">CEIL</span>(DBMS_RANDOM.VALUE(<span class="number">100</span>,<span class="number">106</span>)), SYSDATE</span><br><span class="line">    <span class="keyword">FROM</span> DUAL <span class="keyword">CONNECT</span> <span class="keyword">BY</span> LEVEL <span class="operator">&lt;</span><span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h2 id="复制表结构"><a href="#复制表结构" class="headerlink" title="复制表结构"></a>复制表结构</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 快速复制表结构且不需要数据</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dmhr.t2 <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.t1 <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用 SP_TABLEDEF 过程查看 t2 的结构，所有定义在 t1 列上的约束均没有被新表继承。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需使用如下语句添加各类约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> dmhr.t2  <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> dmhr.t2  <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> name <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;dm2024&#x27;</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> dmhr.t2  <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> class_id <span class="keyword">SET</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> dmhr.t2  <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> tp <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> SYSDATE;</span><br></pre></td></tr></table></figure>

<h2 id="MERGE-INTO-操作"><a href="#MERGE-INTO-操作" class="headerlink" title="MERGE INTO 操作"></a>MERGE INTO 操作</h2><p>使用 MERGE INTO 语法可合并 UPDATE 和 INSERT 语句。通过 MERGE 语句，根据一张表（或视图）的连接条件对另外一张表（或视图）进行查询，连接条件匹配上的进行 UPDATE（可能含有 DELETE），无法匹配的执行 INSERT。</p>
<p>使用 MERGE 可以实现记录“存在则 update，不存在则 insert”的逻辑。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">MERGE</span> <span class="keyword">INTO</span> dmhr.dup_emp</span><br><span class="line">     <span class="keyword">USING</span> dmhr.emp_salary <span class="keyword">ON</span> (dmhr.dup_emp.employee_id <span class="operator">=</span> dmhr.emp_salary.employee_id)</span><br><span class="line"><span class="keyword">WHEN</span> MATCHED</span><br><span class="line"><span class="keyword">THEN</span> </span><br><span class="line">    <span class="keyword">UPDATE</span> <span class="keyword">SET</span> dmhr.dup_emp.salary <span class="operator">=</span> dmhr.emp_salary.new_salary</span><br><span class="line"><span class="keyword">WHEN</span> <span class="keyword">NOT</span> MATCHED</span><br><span class="line"><span class="keyword">THEN</span></span><br><span class="line">   <span class="keyword">INSERT</span> <span class="keyword">VALUES</span> (dmhr.emp_salary.employee_id,<span class="string">&#x27;dm2024&#x27;</span>,<span class="number">410107197103257999</span>,dmhr.emp_salary.new_salary,<span class="number">102</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>目标表 dup_emp 中添加了一条数据，其余行的 salary 列被更新成 emp_salary 中对应的值。如果 emp_salary 中有多行和目标表匹配成功，将会报错：没有一组稳定的行。</p>
</blockquote>
<h2 id="删除重复记录"><a href="#删除重复记录" class="headerlink" title="删除重复记录"></a>删除重复记录</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 通过 group by + having 子句分组查询的方式</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> dmhr.dup_emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> employee_name <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 通过 group by + rowid 的方式</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dmhr.dup_emp</span><br><span class="line"><span class="keyword">WHERE</span> ROWID <span class="keyword">NOT</span> <span class="keyword">IN</span> (  </span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MAX</span> (ROWID) <span class="keyword">FROM</span> dmhr.dup_emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> employee_name </span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 可在查找到重复记录后直接删除                     </span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> dmhr.dup_emp</span><br><span class="line"><span class="keyword">WHERE</span> ROWID <span class="keyword">NOT</span> <span class="keyword">IN</span> (  </span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MAX</span> (ROWID) <span class="keyword">FROM</span> dmhr.dup_emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> employee_name</span><br><span class="line">);</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> dmhr.dup_emp t</span><br><span class="line"><span class="keyword">WHERE</span> ROWID <span class="operator">&lt;&gt;</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MAX</span> (ROWID) <span class="keyword">FROM</span> dmhr.dup_emp <span class="keyword">WHERE</span> employee_name <span class="operator">=</span> t.employee_name</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://southernfish.github.io">Southern Fish</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://southernfish.github.io/pages/database/db-dm-sql/">https://southernfish.github.io/pages/database/db-dm-sql/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://southernfish.github.io" target="_blank">Southern Fish</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/DM/">DM</a></div><div class="post_share"><div class="social-share" data-image="/img/article/article3.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/pages/database/db-redis-produce-problem/"><img class="prev-cover" src="/img/article/article5.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Redis的缓存穿透、缓存击穿、缓存雪崩</div></div></a></div><div class="next-post pull-right"><a href="/pages/database/db-dm/"><img class="next-cover" src="/img/article/article4.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">达梦数据库基础</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/pages/database/db-dm/" title="达梦数据库基础"><img class="cover" src="/img/article/article4.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-17</div><div class="title">达梦数据库基础</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Southern Fish</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">98</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/SouthernFish" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1002721576@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">天下事岂能尽如吾意，心境须恰适，尽其在我，随遇而安。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">常规数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">字符数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E5%A2%9E%E5%8A%A0%E5%BC%95%E5%8F%B7"><span class="toc-number">1.1.1.</span> <span class="toc-text">在字符串中增加引号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E7%AC%A6%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="toc-number">1.1.2.</span> <span class="toc-text">计算字符出现的次数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E5%AD%97%E7%AC%A6"><span class="toc-number">1.1.3.</span> <span class="toc-text">删除字符串中不需要的字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%8E%E6%95%B0%E5%AD%97%E5%88%86%E7%A6%BB"><span class="toc-number">1.1.4.</span> <span class="toc-text">将字符与数字分离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%AA%E5%8C%85%E5%90%AB%E5%AD%97%E6%AF%8D%E6%88%96%E6%95%B0%E5%AD%97%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.5.</span> <span class="toc-text">查询只包含字母或数字的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E6%8E%92%E5%BA%8F"><span class="toc-number">1.1.6.</span> <span class="toc-text">按字符串中的数字排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%88%86%E9%9A%94%E5%88%97%E8%A1%A8"><span class="toc-number">1.1.7.</span> <span class="toc-text">创建分隔列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E5%8F%96%E5%AD%90%E4%B8%B2%E4%B8%8E%E5%88%86%E8%A7%A3-IP-%E5%9C%B0%E5%9D%80"><span class="toc-number">1.1.8.</span> <span class="toc-text">提取子串与分解 IP 地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">数值数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">常用聚集函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E7%B4%AF%E8%AE%A1%E5%92%8C"><span class="toc-number">1.2.2.</span> <span class="toc-text">生成累计和</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%82%E6%80%BB%E5%92%8C%E7%9A%84%E7%99%BE%E5%88%86%E6%AF%94"><span class="toc-number">1.2.3.</span> <span class="toc-text">求总和的百分比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8D%E4%B8%B2%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-BIT"><span class="toc-number">1.3.</span> <span class="toc-text">位串数据类型 BIT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">日期时间数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%87%8F%E6%97%A5%E3%80%81%E6%9C%88%E3%80%81%E5%B9%B4"><span class="toc-number">1.4.1.</span> <span class="toc-text">加减日、月、年</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%87%8F%E6%97%B6%E3%80%81%E5%88%86%E3%80%81%E7%A7%92"><span class="toc-number">1.4.2.</span> <span class="toc-text">加减时、分、秒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E9%97%B4%E9%9A%94%E4%B9%8B%E6%97%B6%E3%80%81%E5%88%86%E3%80%81%E7%A7%92"><span class="toc-number">1.4.3.</span> <span class="toc-text">日期间隔之时、分、秒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E9%97%B4%E9%9A%94%E4%B9%8B%E6%97%A5%E3%80%81%E6%9C%88%E3%80%81%E5%B9%B4"><span class="toc-number">1.4.4.</span> <span class="toc-text">日期间隔之日、月、年</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%82%E4%B8%A4%E4%B8%AA%E6%97%A5%E6%9C%9F%E9%97%B4%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%A4%A9%E6%95%B0"><span class="toc-number">1.4.5.</span> <span class="toc-text">求两个日期间的工作天数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%82%E4%B8%80%E5%B9%B4%E4%B8%AD%E5%91%A8%E5%86%85%E5%90%84%E6%97%A5%E6%9C%9F%E7%9A%84%E5%A4%A9%E6%95%B0"><span class="toc-number">1.4.6.</span> <span class="toc-text">求一年中周内各日期的天数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E5%BD%93%E5%89%8D%E8%AE%B0%E5%BD%95%E5%92%8C%E4%B8%8B%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95%E4%B9%8B%E9%97%B4%E7%9B%B8%E5%B7%AE%E7%9A%84%E5%A4%A9%E6%95%B0"><span class="toc-number">1.4.7.</span> <span class="toc-text">确定当前记录和下一条记录之间相差的天数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SYSDATE"><span class="toc-number">1.4.8.</span> <span class="toc-text">SYSDATE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXTRACT"><span class="toc-number">1.4.9.</span> <span class="toc-text">EXTRACT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E4%B8%80%E5%B9%B4%E6%98%AF%E5%90%A6%E4%B8%BA%E9%97%B0%E5%B9%B4"><span class="toc-number">1.4.10.</span> <span class="toc-text">判断一年是否为闰年</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%A8%E7%9A%84%E8%AE%A1%E7%AE%97"><span class="toc-number">1.4.11.</span> <span class="toc-text">周的计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E4%B8%80%E5%B9%B4%E5%86%85%E5%B1%9E%E4%BA%8E%E5%91%A8%E5%86%85%E6%9F%90%E4%B8%80%E5%A4%A9%E7%9A%84%E6%89%80%E6%9C%89%E6%97%A5%E6%9C%9F"><span class="toc-number">1.4.12.</span> <span class="toc-text">确定一年内属于周内某一天的所有日期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E6%9F%90%E6%9C%88%E5%86%85%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%92%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%9F%90%E5%A4%A9%E7%9A%84%E6%97%A5%E6%9C%9F"><span class="toc-number">1.4.13.</span> <span class="toc-text">确定某月内第一个和最后一个周末某天的日期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%AC%E6%9C%88%E6%97%A5%E5%8E%86"><span class="toc-number">1.4.14.</span> <span class="toc-text">创建本月日历</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E6%8C%87%E5%AE%9A%E5%B9%B4%E4%BB%BD%E5%AD%A3%E5%BA%A6%E7%9A%84%E5%BC%80%E5%A7%8B%E6%97%A5%E6%9C%9F%E5%92%8C%E7%BB%93%E6%9D%9F%E6%97%A5%E6%9C%9F"><span class="toc-number">1.4.15.</span> <span class="toc-text">确定指定年份季度的开始日期和结束日期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E7%BB%99%E5%AE%9A%E7%9A%84%E6%97%B6%E9%97%B4%E5%8D%95%E4%BD%8D%E6%9F%A5%E6%89%BE"><span class="toc-number">1.4.16.</span> <span class="toc-text">按照给定的时间单位查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%97%A5%E6%9C%9F%E7%9A%84%E7%89%B9%E6%AE%8A%E9%83%A8%E5%88%86%E6%AF%94%E8%BE%83%E8%AE%B0%E5%BD%95"><span class="toc-number">1.4.17.</span> <span class="toc-text">使用日期的特殊部分比较记录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E5%AA%92%E4%BD%93%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.</span> <span class="toc-text">多媒体数据类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2-SQL-%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">单表查询 SQL 操作方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">查看表结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E8%A1%A8%E6%95%B0%E6%8D%AE%E6%A3%80%E7%B4%A2"><span class="toc-number">2.2.</span> <span class="toc-text">全表数据检索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">行过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E5%80%BC"><span class="toc-number">2.4.</span> <span class="toc-text">空值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E8%A1%A8"><span class="toc-number">2.5.</span> <span class="toc-text">临时表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E5%88%AB%E5%90%8D%E5%8F%8A%E9%83%A8%E5%88%86%E5%88%97%E6%A3%80%E7%B4%A2"><span class="toc-number">2.6.</span> <span class="toc-text">列别名及部分列检索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#where-%E5%AD%90%E5%8F%A5%E4%B8%AD%E5%BC%95%E7%94%A8%E5%88%AB%E5%90%8D%E5%88%97"><span class="toc-number">2.7.</span> <span class="toc-text">where 子句中引用别名列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E6%8B%BC%E6%8E%A5"><span class="toc-number">2.8.</span> <span class="toc-text">列拼接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E9%80%BB%E8%BE%91"><span class="toc-number">2.9.</span> <span class="toc-text">条件逻辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E8%BF%94%E5%9B%9E%E7%9A%84%E8%A1%8C%E6%95%B0"><span class="toc-number">2.10.</span> <span class="toc-text">限制返回的行数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E6%8E%92%E5%BA%8F"><span class="toc-number">2.11.</span> <span class="toc-text">查询结果排序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E5%AD%90%E4%B8%B2%E6%8E%92%E5%BA%8F"><span class="toc-number">2.11.1.</span> <span class="toc-text">按子串排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TRANSLATE-%E5%BA%94%E7%94%A8"><span class="toc-number">2.11.2.</span> <span class="toc-text">TRANSLATE 应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E6%95%B0%E5%AD%97%E5%92%8C%E5%AD%97%E6%AF%8D%E6%B7%B7%E5%90%88%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AF%8D%E6%8E%92%E5%BA%8F"><span class="toc-number">2.11.3.</span> <span class="toc-text">按数字和字母混合字符串中的字母排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E6%8C%87%E5%AE%9A%E6%9D%A1%E4%BB%B6%E6%8E%92%E5%BA%8F"><span class="toc-number">2.11.4.</span> <span class="toc-text">按指定条件排序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E5%A4%84%E7%90%86"><span class="toc-number">2.12.</span> <span class="toc-text">范围处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2-SQL-%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">多表查询 SQL 操作方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#union-all"><span class="toc-number">3.1.</span> <span class="toc-text">union all</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#union-all-%E4%B8%8E%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">3.1.1.</span> <span class="toc-text">union all 与空字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#union-all-%E4%B8%8E-or"><span class="toc-number">3.1.2.</span> <span class="toc-text">union all 与 or</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%AE%E9%9B%86%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.</span> <span class="toc-text">差集函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IN%E3%80%81NOT-IN%E3%80%81EXISTS"><span class="toc-number">3.3.</span> <span class="toc-text">IN、NOT IN、EXISTS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.</span> <span class="toc-text">连接类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5"><span class="toc-number">4.</span> <span class="toc-text">数据操纵</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">4.1.</span> <span class="toc-text">插入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%8F%92%E5%85%A5"><span class="toc-number">4.1.1.</span> <span class="toc-text">单表插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%8F%92%E5%85%A5"><span class="toc-number">4.1.2.</span> <span class="toc-text">多表插入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.</span> <span class="toc-text">复制表结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MERGE-INTO-%E6%93%8D%E4%BD%9C"><span class="toc-number">4.3.</span> <span class="toc-text">MERGE INTO 操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E8%AE%B0%E5%BD%95"><span class="toc-number">4.4.</span> <span class="toc-text">删除重复记录</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/pages/high-availability/server-limit-stream/" title="服务限流"><img src="/img/article/article1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="服务限流"/></a><div class="content"><a class="title" href="/pages/high-availability/server-limit-stream/" title="服务限流">服务限流</a><time datetime="2025-09-18T09:02:36.000Z" title="发表于 2025-09-18 17:02:36">2025-09-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/pages/database/db-redis-persistence/" title="Redis的持久化机制"><img src="/img/article/article6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis的持久化机制"/></a><div class="content"><a class="title" href="/pages/database/db-redis-persistence/" title="Redis的持久化机制">Redis的持久化机制</a><time datetime="2025-09-18T01:15:36.000Z" title="发表于 2025-09-18 09:15:36">2025-09-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/pages/database/cache-read-write-strategies/" title="三大缓存读写策略"><img src="/img/article/article6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="三大缓存读写策略"/></a><div class="content"><a class="title" href="/pages/database/cache-read-write-strategies/" title="三大缓存读写策略">三大缓存读写策略</a><time datetime="2025-09-17T13:15:36.000Z" title="发表于 2025-09-17 21:15:36">2025-09-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/pages/database/db-redis-consistency/" title="Redis缓存与数据库的一致性"><img src="/img/article/article2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis缓存与数据库的一致性"/></a><div class="content"><a class="title" href="/pages/database/db-redis-consistency/" title="Redis缓存与数据库的一致性">Redis缓存与数据库的一致性</a><time datetime="2025-09-17T13:15:36.000Z" title="发表于 2025-09-17 21:15:36">2025-09-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/pages/database/db-redis-produce-problem/" title="Redis的缓存穿透、缓存击穿、缓存雪崩"><img src="/img/article/article5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis的缓存穿透、缓存击穿、缓存雪崩"/></a><div class="content"><a class="title" href="/pages/database/db-redis-produce-problem/" title="Redis的缓存穿透、缓存击穿、缓存雪崩">Redis的缓存穿透、缓存击穿、缓存雪崩</a><time datetime="2025-09-17T13:15:36.000Z" title="发表于 2025-09-17 21:15:36">2025-09-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/article/article3.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Southern Fish</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>